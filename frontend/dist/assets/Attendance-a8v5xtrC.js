import{j as e}from"./ui-B9MhWaVJ.js";import{r as s}from"./router-D7BdrHDj.js";import{C as a,D as r}from"./DocumentSignature-DbJr6GhM.js";import{X as t,m as i,B as n,ar as l,n as d,o as c,p as o,q as m,r as x,l as h,h as u,ak as g,$ as j,a as p,t as b,ao as y,ap as N,aq as f,as as w,at as v,au as k}from"./index-Dh3VsLo2.js";import{T as D,a as T,b as H,c as S,d as C,e as A}from"./table-n3dh8fC-.js";import{T as E,a as M,b as q,c as B}from"./tooltip-BlSP5LEe.js";import"./progress-CFMoxU24.js";import{A as L,a as z,b as P}from"./alert-A6WFojaW.js";import{L as R}from"./loader-circle-MNtbErZU.js";import{C as F}from"./circle-alert-CDKGMAAk.js";import{C as I}from"./circle-check-big-Cd9MIL-W.js";import{D as V}from"./DashboardLayout-KgKZtk43.js";import{C as $}from"./clipboard-check-Bz6fJHyz.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";
/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=t("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),W={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05,delayChildren:.1}}},G={hidden:{y:10,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:25}}},U=()=>{const[a,r]=s.useState(!0),[t,y]=s.useState(null),[N,f]=s.useState(null),[w,v]=s.useState(!1),k=async()=>{try{w?v(!0):r(!0),f(null),await p.ensureUserDataInLocalStorage();const e=localStorage.getItem("token");if(!e)throw new Error("Token d'authentification non trouvé");const s=await fetch("http://localhost:8000/api/signatures/weekly",{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok){const e=await s.json().catch((()=>({})));throw new Error(e.message||`Erreur ${s.status}`)}const a=await s.json();a&&a.signaturesByDate&&(a.signaturesByDate=a.signaturesByDate.filter((e=>!["Saturday","Sunday"].includes(e.dayName)))),console.log("Weekly signature history:",a),y(a)}catch(e){console.error("Error fetching weekly history:",e),f(e.message||"Erreur de chargement de l'historique"),b.error("Erreur",{description:e.message||"Impossible de charger l'historique des signatures"})}finally{r(!1),v(!1)}};s.useEffect((()=>{k()}),[]);if(a&&!w)return e.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(R,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Chargement de l'historique des signatures..."})]});if(N)return e.jsx(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(L,{variant:"destructive",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx(z,{children:"Erreur"}),e.jsxs(P,{children:[N,e.jsxs(n,{className:"mt-4",variant:"outline",onClick:k,size:"sm",children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]})]})});if(!t)return e.jsx(i.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-muted-foreground"}),"Aucune donnée"]}),e.jsx(m,{children:"Aucun historique de signatures n'est disponible"})]}),e.jsx(x,{children:e.jsxs(n,{variant:"outline",onClick:k,size:"sm",className:"w-full",children:[e.jsx(l,{className:"h-4 w-4 mr-2"}),"Actualiser les données"]})})]})});const V=(()=>{if(!t?.signaturesByDate)return{total:0,present:0};let e=0,s=0;const a=new Date;a.setHours(0,0,0,0);const r=(new Date).getHours();return t.signaturesByDate.forEach((t=>{const i=new Date(t.date);i.setHours(0,0,0,0);const n=i>a,l=!(i.getTime()===a.getTime()&&r<12),d=!(i.getTime()===a.getTime()&&r<17);n||(l&&(e+=1,t.signatures.morning&&(s+=1)),d&&(e+=1,t.signatures.afternoon&&(s+=1)))})),{total:e,present:s,percentage:e>0?Math.round(s/e*100):0}})();return e.jsxs(i.div,{className:"space-y-6",variants:W,initial:"hidden",animate:"visible",children:[e.jsx(i.div,{variants:G,children:e.jsxs(d,{className:"overflow-hidden border-blue-100 dark:border-blue-900/50",children:[e.jsx(c,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-900/30 border-b border-blue-100 dark:border-blue-900/10",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(o,{className:"text-blue-800 dark:text-blue-400 flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Résumé de la semaine"]})})}),e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800/30 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(I,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Présent"})]}),e.jsx("span",{className:"text-2xl font-bold text-green-600",children:V.present}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"périodes"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800/30 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(h,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Absent"})]}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:V.total-V.present}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"périodes"})]})]})})]})}),e.jsx(i.div,{variants:G,children:e.jsxs(d,{children:[e.jsxs(c,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-primary"}),"Détail des signatures"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{v(!0),k()},disabled:w,className:"gap-1",children:[w?e.jsx(R,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(l,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Actualiser"})]})]}),e.jsx(m,{children:"Historique détaillé des signatures pour la semaine en cours"})]}),e.jsx(x,{className:"p-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(D,{children:[e.jsx(T,{children:e.jsxs(H,{children:[e.jsx(S,{className:"w-[100px]",children:"Jour"}),e.jsx(S,{children:"Date"}),e.jsx(S,{className:"text-center",children:"Matin (9h-12h)"}),e.jsx(S,{className:"text-center",children:"Après-midi (13h-17h)"})]})}),e.jsx(C,{children:t.signaturesByDate.map((s=>{return e.jsxs(H,{children:[e.jsx(A,{className:"font-medium",children:(a=s.dayName,{Monday:"Lundi",Tuesday:"Mardi",Wednesday:"Mercredi",Thursday:"Jeudi",Friday:"Vendredi"}[a]||a)}),e.jsx(A,{children:new Date(s.date).toLocaleDateString("fr-FR")}),e.jsx(A,{className:"text-center",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(q,{className:"cursor-help inline-flex",children:s.signatures.morning?e.jsxs(g,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800 gap-1",children:[e.jsx(I,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Présent"})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const r=new Date(s.date);r.setHours(0,0,0,0);return r>a||r.getTime()===a.getTime()&&(new Date).getHours()<12?e.jsxs(g,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800 gap-1",children:[e.jsx(u,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"À venir"})]}):e.jsxs(g,{variant:"outline",className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800 gap-1",children:[e.jsx(h,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Absent"})]})})()}),e.jsx(B,{side:"bottom",children:s.signatures.morning?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{children:["Signé à ",new Date(s.signatures.morning.date).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const r=new Date(s.date);r.setHours(0,0,0,0);return r>a||r.getTime()===a.getTime()&&(new Date).getHours()<12?e.jsx("p",{children:"Période à venir"}):e.jsx("p",{children:"Aucune signature enregistrée"})})()})]})})}),e.jsx(A,{className:"text-center",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(q,{className:"cursor-help inline-flex",children:s.signatures.afternoon?e.jsxs(g,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800 gap-1",children:[e.jsx(I,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Présent"})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const r=new Date(s.date);r.setHours(0,0,0,0);return r>a||r.getTime()===a.getTime()&&(new Date).getHours()<17?e.jsxs(g,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800 gap-1",children:[e.jsx(u,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"À venir"})]}):e.jsxs(g,{variant:"outline",className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800 gap-1",children:[e.jsx(h,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Absent"})]})})()}),e.jsx(B,{side:"bottom",children:s.signatures.afternoon?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{children:["Signé à ",new Date(s.signatures.afternoon.date).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const r=new Date(s.date);r.setHours(0,0,0,0);return r>a||r.getTime()===a.getTime()&&(new Date).getHours()<17?e.jsx("p",{children:"Période à venir"}):e.jsx("p",{children:"Aucune signature enregistrée"})})()})]})})})]},s.date);var a}))})]})})})]})})]})},X={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.1}}},K={hidden:{y:15,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:400,damping:25}}},O=()=>{const[t,n]=s.useState("signature");return e.jsxs(V,{headerIcon:a,headerTitle:"Enregistrement de présence",className:"p-0",children:[e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(i.div,{variants:X,initial:"hidden",animate:"visible",className:"max-w-4xl mx-auto",children:e.jsx(i.div,{variants:K,className:"mb-6",children:e.jsx(d,{className:"border-none shadow-md",children:e.jsx(x,{className:"pt-6",children:e.jsxs(y,{defaultValue:"signature",onValueChange:n,className:"w-full",children:[e.jsxs(N,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(f,{value:"signature",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{children:"Signer"})]}),e.jsxs(f,{value:"history",className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Historique"})]})]}),e.jsx(v,{value:"signature",children:e.jsx(r,{})}),e.jsx(v,{value:"history",children:e.jsx(U,{})})]})})})})})}),e.jsx(k,{})]})};export{O as default};
