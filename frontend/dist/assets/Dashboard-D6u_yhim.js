import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,L as r}from"./router-D7BdrHDj.js";import{u as i}from"./useDashboardQueries-CIXQ-9_k.js";import{O as a,t,b as l,T as o,m as n,k as d,p as c,aa as u,ad as m,D as h,g as p,y as x,h as j,i as f,z as g,B as b,r as N}from"./index-Bd05LC-l.js";import{I as v}from"./input-CRxVDqWf.js";import{L as y}from"./label-8eTlumoe.js";import{D as C}from"./DashboardLayout-BvekbIMj.js";import{C as k}from"./checkbox-CoApv7hz.js";import{B as w}from"./book-DpAfCfaO.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";import"./circle-alert-DkC07JJn.js";const E={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.1}}},S={hidden:{y:15,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:400,damping:25}}},L=()=>{const{user:L,users:F,isLoading:$,isError:A,error:D,refetch:G}=i(),[I,T]=s.useState(!1),[U,q]=s.useState(!1),[z,O]=s.useState(null),[R,V]=s.useState("ALL"),[B,M]=s.useState("calendar"),[Q,P]=s.useState({firstName:"",lastName:"",email:"",phoneNumber:""}),H=s.useRef(!1),[J,K]=s.useState([]),[W,X]=s.useState([]),[Y,Z]=s.useState(!1),_=[{title:"Gestion des utilisateurs",description:"Gérer les utilisateurs",icon:u,color:"from-blue-500 to-blue-600",textColor:"text-blue-50",link:"/admin/users"},{title:"Gestion des invités",description:"Gérer les rôles des étudiants invités",icon:u,color:"from-indigo-500 to-indigo-600",textColor:"text-indigo-50",link:"/recruiter/guest-student-roles"},{title:"Formations",description:"Gérer et consulter les formations",icon:w,color:"from-purple-500 to-purple-600",textColor:"text-purple-50",link:"/formations"}],ee=a((e=>e&&e.id?`/users/${e.id}`:"/users"),"put","admin-users",{onSuccess:()=>{T(!1),G(),t.success("Les informations de l'utilisateur ont été mises à jour.")},onError:e=>{console.error("Erreur lors de la modification de l'utilisateur:",e),t.error("Impossible de modifier l'utilisateur.")}});a((e=>e?`/users/${e}`:"/users"),"delete","admin-users",{onSuccess:()=>{q(!1),G(),t.success("L'utilisateur a été supprimé avec succès.")},onError:e=>{console.error("Erreur lors de la suppression de l'utilisateur:",e),t.error("Impossible de supprimer l'utilisateur.")}});s.useEffect((()=>{(async()=>{Z(!0);try{const e=await N.get("/user-roles/roles");e.success&&e.data?K(e.data):t.error("Impossible de récupérer les rôles disponibles")}catch(e){console.error("Erreur lors de la récupération des rôles:",e),t.error("Échec de la récupération des rôles")}finally{Z(!1)}})()}),[]);const se=e=>{const{name:s,value:r}=e.target;P((e=>({...e,[s]:r})))};return F?.filter((e=>"ALL"===R||!R||e.roles&&e.roles.some((e=>e.name===R)))),s.useEffect((()=>{if(!L&&!H.current&&!$){H.current=!0;const e=setTimeout((()=>{l.getCurrentUser()}),300);return()=>clearTimeout(e)}}),[L,$]),e.jsx(C,{loading:$,error:A?D?.message||"Une erreur est survenue lors du chargement des données":null,className:"p-0",user:L,headerIcon:o,headerTitle:"Tableau de bord administrateur",children:e.jsxs("div",{className:"container p-4 mx-auto sm:p-6 lg:p-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[e.jsx(n.div,{variants:E,initial:"hidden",animate:"visible",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4 mb-8"}),e.jsx(d,{className:"border-0 shadow-md mb-6",children:e.jsxs(c,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6",children:"Accès rapide"}),e.jsx(n.div,{variants:E,initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:_.map(((s,i)=>e.jsx(n.div,{variants:S,className:"h-full",children:e.jsx(r,{to:s.link,className:"block h-full",children:e.jsxs("div",{className:"relative h-full overflow-hidden rounded-xl shadow-sm hover:shadow-md transition-all duration-300 group",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${s.color} opacity-90 group-hover:opacity-100 transition-opacity`}),e.jsxs("div",{className:"relative p-5 h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-white/20 backdrop-blur-sm",children:e.jsx(s.icon,{className:"w-5 h-5 text-white"})}),e.jsx("div",{className:"p-1.5 rounded-full bg-white/20 backdrop-blur-sm",children:e.jsx(m,{className:"w-4 h-4 text-white"})})]}),e.jsx("h2",{className:"text-xl font-semibold text-white mb-1",children:s.title}),e.jsx("p",{className:"text-white/80 text-sm mb-4",children:s.description})]})]})})},i)))})]})}),e.jsx(h,{open:I,onOpenChange:T,children:e.jsxs(p,{className:"no-focus-outline",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Modifier l'utilisateur"}),e.jsx(f,{children:"Modifier les informations de l'utilisateur"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!z||!z.id)return void t.error("Utilisateur invalide. Veuillez réessayer.");const s={...Q,id:z.id,roles:W};try{ee.mutate(s)}catch(r){console.error("Error in handleEditUser:",r),t.error("Une erreur s'est produite. Veuillez réessayer.")}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"firstName",children:"Prénom"}),e.jsx(v,{id:"firstName",name:"firstName",value:Q.firstName,onChange:se,required:!0,className:"no-focus-outline"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"lastName",children:"Nom"}),e.jsx(v,{id:"lastName",name:"lastName",value:Q.lastName,onChange:se,required:!0,className:"no-focus-outline"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"email",children:"Email"}),e.jsx(v,{id:"email",name:"email",type:"email",value:Q.email,onChange:se,required:!0,className:"no-focus-outline"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"phoneNumber",children:"Numéro de téléphone"}),e.jsx(v,{id:"phoneNumber",name:"phoneNumber",value:Q.phoneNumber,onChange:se,className:"no-focus-outline"})]}),e.jsxs("div",{children:[e.jsx(y,{className:"mb-2 block",children:"Rôles"}),Y?e.jsx("div",{className:"py-2 text-sm text-gray-500",children:"Chargement des rôles..."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:J.map((s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:`role-${s.id}`,checked:W.includes(s.id),onCheckedChange:()=>{return e=s.id,void X((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]));var e},className:"no-focus-outline"}),e.jsx(y,{htmlFor:`role-${s.id}`,className:"text-sm font-normal",children:s.name})]},s.id)))})]}),e.jsxs(g,{children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>T(!1),className:"no-focus-outline",children:"Annuler"}),e.jsx(b,{type:"submit",disabled:ee.isLoading,className:"no-focus-outline",children:ee.isLoading?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(h,{open:U,onOpenChange:q,children:e.jsxs(p,{className:"no-focus-outline",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Supprimer l'utilisateur"}),e.jsx(f,{children:"Êtes-vous sûr de vouloir supprimer cet utilisateur ? Cette action est irréversible."})]}),e.jsx(g,{children:e.jsx(b,{variant:"outline",onClick:()=>q(!1),className:"no-focus-outline",children:"Annuler"})})]})})]})})};export{L as default};
