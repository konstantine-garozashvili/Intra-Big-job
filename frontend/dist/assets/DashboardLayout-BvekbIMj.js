import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,L as a,h as r}from"./router-D7BdrHDj.js";import{h as t}from"./charts-DkICKEBk.js";import{s as l,S as i,ax as c,b as o,m as n,ay as m,W as d,B as x,U as u}from"./index-Bd05LC-l.js";import{C as h}from"./circle-alert-DkC07JJn.js";
/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=l("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),f=({variant:s="default"})=>"compact"===s?e.jsxs("div",{className:"flex items-center space-x-3 p-2",children:[e.jsx(i,{className:"h-8 w-8 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-4 w-24"}),e.jsx(i,{className:"h-3 w-16"})]})]}):"avatar"===s?e.jsx(i,{className:"h-10 w-10 rounded-full"}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 w-full max-w-md",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(i,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(i,{className:"h-5 w-40"}),e.jsx(i,{className:"h-4 w-32"}),e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(i,{className:"h-8 w-20 rounded-md"}),e.jsx(i,{className:"h-8 w-20 rounded-md"})]})]})]})}),p=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-8 w-48"})," ",e.jsx(i,{className:"h-4 w-64"})," "]}),e.jsx(i,{className:"h-10 w-32 rounded-md"})," "]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map(((s,a)=>e.jsx(i,{className:"h-28 rounded-lg"},a)))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(i,{className:"h-72 rounded-lg"})," ",e.jsx(i,{className:"h-64 rounded-lg"})," "]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{className:"h-6 w-32"})," ",e.jsx(f,{})," "]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{className:"h-6 w-32"})," ",e.jsx(i,{className:"h-48 rounded-lg"})," "]})]})]})]}),g=e=>Boolean(e&&"object"==typeof e&&e.firstName&&e.lastName),j=s.memo((({user:r,icon:t,roleTitle:l})=>{const h=s.useRef(null),[p,j]=s.useState({}),[v,w]=s.useState(new Date);s.useEffect((()=>{const e=setInterval((()=>{w(new Date)}),1e3);return()=>clearInterval(e)}),[]),s.useEffect((()=>{if(console.log("DashboardHeader - User data received:",r),console.log("DashboardHeader - Current stable user data:",h.current),console.log("DashboardHeader - Has complete data:",g(r)),!g(r)&&!h.current){try{const e=c.getCachedUserData();if(console.log("DashboardHeader - Attempting to get data from userDataManager:",e),g(e)){const s={firstName:e.firstName,lastName:e.lastName,profilePicture:e.profilePicture||e.avatar,fullName:`${e.firstName} ${e.lastName}`};return h.current=s,j(s),void console.log("DashboardHeader - Using userDataManager cache data as fallback")}}catch(e){console.error("DashboardHeader - Error retrieving data from userDataManager:",e)}try{const e=o.getMinimalUserData();if(console.log("DashboardHeader - Attempting to get data from localStorage:",e),g(e)){const s={firstName:e.firstName,lastName:e.lastName,profilePicture:e.profilePicture||e.avatar,fullName:`${e.firstName} ${e.lastName}`};h.current=s,j(s),console.log("DashboardHeader - Using localStorage data as fallback")}}catch(e){console.error("DashboardHeader - Error retrieving data from localStorage:",e)}}}),[r]);const[b,y]=s.useState(!1),D=s.useRef(null),k=s.useRef(!1),H=s.useRef(Date.now());s.useMemo((()=>p.firstName&&p.lastName?`${p.firstName[0]}${p.lastName[0]}`:r?.firstName&&r?.lastName?`${r.firstName[0]}${r.lastName[0]}`:"U"),[r,p]),s.useEffect((()=>{if(r&&(r.firstName||r.lastName)){console.log("DashboardHeader - Updating with partial data:",{firstName:r.firstName,lastName:r.lastName});const e={firstName:r.firstName||h.current?.firstName,lastName:r.lastName||h.current?.lastName,profilePicture:r.profilePicture||r.avatar||h.current?.profilePicture,fullName:`${r.firstName||""} ${r.lastName||""}`.trim()};h.current=e,j(e),k.current=!0,H.current=Date.now(),y(!1),D.current&&(clearTimeout(D.current),D.current=null)}else if(g(r)){if(console.log("DashboardHeader - Updating with complete data"),k.current=!0,H.current=Date.now(),!h.current||h.current.firstName!==r.firstName||h.current.lastName!==r.lastName){const e={firstName:r.firstName,lastName:r.lastName,profilePicture:r.profilePicture||r.avatar,fullName:`${r.firstName} ${r.lastName}`};h.current=e,j(e)}y(!1),D.current&&(clearTimeout(D.current),D.current=null)}else if(g(r)||h.current){if(h.current&&k.current){const e=Date.now()-H.current;console.log("DashboardHeader - Using stable data, time since last valid data:",e),e>1e4&&(console.log("DashboardHeader - Data missing for too long, showing skeleton"),y(!0))}}else console.log("DashboardHeader - No data available, showing skeleton soon"),D.current||(D.current=setTimeout((()=>{y(!0)}),300));return()=>{D.current&&clearTimeout(D.current)}}),[r]),s.useEffect((()=>{console.log("DashboardHeader - Final display data:",p)}),[p]);const{firstName:$,lastName:M,profilePicture:T}=p;return b?e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5 overflow-hidden mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(f,{variant:"compact"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Bonjour,"}),e.jsx(i,{className:"h-8 w-32"}),e.jsx(i,{className:"h-5 w-5 rounded-full"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(i,{className:"h-3.5 w-3.5"}),e.jsx(i,{className:"h-4 w-24"})]})]})]}),e.jsxs("div",{className:"flex items-center mt-4 md:mt-0 gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2"}),e.jsx(i,{className:"h-6 w-16"})]}),e.jsx(i,{className:"h-9 w-[105px] rounded-md"})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-indigo-600"})]}):e.jsxs(n.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5 overflow-hidden mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"relative h-16 w-16 sm:h-12 sm:w-12 md:h-16 md:w-16 lg:h-18 lg:w-18",children:e.jsx(m,{className:"w-full h-full"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:$?e.jsxs(e.Fragment,{children:["Bonjour, ",$," ",e.jsx("span",{className:"inline-block ml-2",children:e.jsx(n.div,{className:"w-5 h-5 text-yellow-500",animate:{rotate:[0,20,0,-20,0],scale:[1,1.2,1,1.2,1]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Bonjour,"}),e.jsx(i,{className:"h-8 w-32"})]})}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 flex items-center gap-1.5 mt-1",children:[t?e.jsx(t,{className:"h-3.5 w-3.5 text-primary"}):e.jsx(N,{className:"h-3.5 w-3.5 text-primary"}),e.jsx("span",{children:l})]})]})]}),e.jsxs("div",{className:"flex items-center mt-4 md:mt-0 gap-3",children:[e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(d,{className:"w-5 h-5 mr-2 text-blue-500 dark:text-blue-400"}),e.jsx("span",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:v.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit",hour12:!1})})]}),e.jsx(a,{to:"/profile",children:e.jsxs(x,{size:"sm",className:"gap-2 bg-primary hover:bg-primary/90",children:[e.jsx(u,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Mon profil"})]})})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-indigo-600"})]})}),((e,s)=>!e.user&&!s.user||!(!e.user||!s.user)&&(e.user?.firstName===s.user?.firstName&&(e.user?.lastName===s.user?.lastName&&(e.user?.profilePicture===s.user?.profilePicture&&(e.user?.avatar===s.user?.avatar&&e.roleTitle===s.roleTitle)))))),v=s.memo((({errorMessage:s})=>e.jsx(n.div,{className:"bg-white rounded-lg shadow-lg p-6",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(h,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-red-800 mb-2",children:"Une erreur est survenue"}),e.jsx("p",{className:"text-red-600",children:s}),e.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Veuillez réessayer ultérieurement ou contacter le support si le problème persiste."})]})]})})));v.displayName="ErrorDisplay",v.propTypes={errorMessage:t.string.isRequired};const w=({error:s,children:a,className:t="",isLoading:l,showSkeleton:i=!0,user:c,headerIcon:o,headerTitle:n,showHeader:m=!0})=>{const d=r()||{};return(l||d.isLoading&&!d.hasMinimalData)&&i?e.jsx("div",{className:`container mx-auto p-8 ${t}`,children:e.jsx(p,{})}):s?e.jsx("div",{className:`container mx-auto p-8 ${t}`,children:e.jsx(v,{errorMessage:s})}):e.jsxs("div",{className:`container mx-auto p-8 ${t}`,children:[m&&c&&e.jsx(j,{user:c,icon:o,roleTitle:n}),a]})};w.propTypes={error:t.string,children:t.node.isRequired,className:t.string,isLoading:t.bool,showSkeleton:t.bool,user:t.object,headerIcon:t.elementType,headerTitle:t.string,showHeader:t.bool};const b=s.memo(w);export{b as D};
