import{j as e}from"./ui-B5ZVMT00.js";import{r as s,u as a,L as r}from"./router-Cgxi-4fo.js";import{o as l,v as t,S as o,w as n,m as i,E as c,F as d,B as m,L as u,t as x,aP as f}from"./index-2R14kkJt.js";import{I as h}from"./input-BH5hxCrP.js";import{L as p}from"./label-B36SXJd3.js";import{S as j,a as g,b as w,c as y,d as b}from"./select-DHEswR4L.js";import"./react-0RZ2pslC.js";import"./query-DUefEkVx.js";import"./charts-D4j3G6dB.js";import"./index-jVOyRz7F.js";function N(e){if(!e)return"";return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"})}function v(){const[v,k]=s.useState([]),[C,S]=s.useState(!0),[A,I]=s.useState(null),[q,P]=s.useState([]),[F,$]=s.useState("all"),[D,E]=s.useState("desc"),[L,T]=s.useState(""),[B,z]=s.useState({open:!1,requestId:null,action:null}),[R,U]=s.useState("");a();const H=async()=>{S(!0);try{const e=localStorage.getItem("token"),s=await fetch("/api/formation-requests",{headers:{Authorization:`Bearer ${e}`}}),a=await s.json();k(a.requests||[])}catch(e){x.error("Erreur lors du chargement des demandes")}finally{S(!1)}};s.useEffect((()=>{H(),(async()=>{try{const{formations:e}=await f.getAllFormations(1,1e3,"");P(e)}catch(e){x.error("Erreur lors du chargement des formations")}})()}),[]);const J=v.filter((e=>"all"===F||e.formation.id.toString()===F)).filter((e=>{if(!L.trim())return!0;const s=L.trim().toLowerCase(),a=e.user.firstName?.toLowerCase()||"",r=e.user.lastName?.toLowerCase()||"";return a.includes(s)||r.includes(s)})).sort(((e,s)=>{const a=new Date(e.createdAt),r=new Date(s.createdAt);return"desc"===D?r-a:a-r}));return C?e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Demandes d'inscription aux formations"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[...Array(3)].map(((s,a)=>e.jsx("div",{className:"",children:e.jsxs(l,{className:"flex flex-col justify-between shadow-xl border-0 bg-gradient-to-br from-yellow-50/80 to-yellow-100/60 dark:from-yellow-900/30 dark:to-yellow-800/20",children:[e.jsxs(t,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(o,{className:"w-12 h-12 rounded-full bg-yellow-300 dark:bg-yellow-800"}),e.jsxs("div",{children:[e.jsx(o,{className:"h-5 w-32 rounded mb-2"}),e.jsx(o,{className:"h-3 w-24 rounded"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"h-3 w-16 rounded"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-yellow-200 dark:bg-yellow-700",children:e.jsx(o,{className:"h-3 w-20 block rounded"})})]}),e.jsx(o,{className:"mt-2 h-3 w-28 rounded"})]}),e.jsxs(n,{className:"p-6 pt-0 flex justify-end gap-2",children:[e.jsx(o,{className:"h-8 w-24 rounded-full"}),e.jsx(o,{className:"h-8 w-24 rounded-full"})]})]})},a)))})]}):e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Demandes d'inscription aux formations"}),e.jsxs("div",{className:"w-full flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-8",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-4 min-w-[220px]",children:[e.jsx(p,{htmlFor:"formation-filter",children:"Filtrer par formation"}),e.jsxs(j,{value:F,onValueChange:$,children:[e.jsx(g,{id:"formation-filter",className:"w-full",children:e.jsx(w,{placeholder:"Toutes les formations"})}),e.jsxs(y,{children:[e.jsx(b,{value:"all",children:"Toutes les formations"}),q.map((s=>e.jsx(b,{value:s.id.toString(),children:s.name},s.id)))]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4 min-w-[180px]",children:[e.jsx(p,{htmlFor:"sort-filter",children:"Trier par"}),e.jsxs(j,{value:D,onValueChange:E,children:[e.jsx(g,{id:"sort-filter",className:"w-full",children:e.jsx(w,{})}),e.jsxs(y,{children:[e.jsx(b,{value:"desc",children:"Plus récent d'abord"}),e.jsx(b,{value:"asc",children:"Plus vieux d'abord"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4 min-w-[200px]",children:[e.jsx(p,{htmlFor:"user-search",children:"Filtrer par prénom/nom"}),e.jsx(h,{id:"user-search",type:"text",placeholder:"Prénom ou nom...",value:L,onChange:e=>T(e.target.value),className:"w-full"})]})]}),0===J.length?e.jsx("div",{className:"text-center text-gray-500",children:"Aucune demande en attente."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:J.map(((s,a)=>{return e.jsx(i.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.07*a,duration:.5,type:"spring",stiffness:120},children:e.jsxs(l,{className:"flex flex-col justify-between shadow-xl border-0 bg-gradient-to-br from-yellow-50/80 to-yellow-100/60 dark:from-yellow-900/30 dark:to-yellow-800/20 hover:scale-[1.025] transition-transform",children:[e.jsxs(t,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.user.profilePictureUrl?e.jsx(r,{to:`/profile/${s.user.id}`,tabIndex:-1,onClick:e=>e.stopPropagation(),className:"block",children:e.jsx("img",{src:s.user.profilePictureUrl,alt:s.user.firstName,className:"w-12 h-12 rounded-full object-cover border-2 border-yellow-300"})}):e.jsx(r,{to:`/profile/${s.user.id}`,tabIndex:-1,onClick:e=>e.stopPropagation(),className:"block",children:e.jsx(c,{className:"h-12 w-12 border-2 border-yellow-300",children:e.jsx(d,{className:"bg-yellow-100 text-yellow-700 dark:bg-yellow-800 dark:text-yellow-100",children:(o=s.user,o?`${o.firstName?.[0]||""}${o.lastName?.[0]||""}`.toUpperCase():"")})})}),e.jsxs("div",{children:[e.jsxs(r,{to:`/profile/${s.user.id}`,className:"font-semibold text-lg text-yellow-900 dark:text-yellow-100 block hover:underline",onClick:e=>e.stopPropagation(),tabIndex:-1,children:[s.user.firstName," ",s.user.lastName]}),e.jsx("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:s.user.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Formation"}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-yellow-200 dark:bg-yellow-700 text-yellow-900 dark:text-yellow-100 text-xs font-semibold ml-2",children:s.formation.name})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Demandé le ",N(s.createdAt)]})]}),e.jsxs(n,{className:"p-6 pt-0 flex justify-end gap-2",children:[e.jsxs(m,{onClick:()=>z({open:!0,requestId:s.id,action:"accept"}),disabled:A===s.id,className:"bg-gradient-to-r from-yellow-300 to-yellow-500 text-yellow-900 font-bold rounded-full shadow-lg hover:from-yellow-400 hover:to-yellow-600 hover:scale-105 focus:ring-2 focus:ring-yellow-300 transition-all px-5 py-2",children:[A===s.id?e.jsx(u,{className:"animate-spin w-4 h-4 mr-2"}):null,"Accepter"]}),e.jsxs(m,{onClick:()=>z({open:!0,requestId:s.id,action:"reject"}),disabled:A===s.id,className:"bg-gradient-to-r from-orange-300 to-orange-500 text-orange-900 font-bold rounded-full shadow-lg hover:from-orange-400 hover:to-orange-600 hover:scale-105 focus:ring-2 focus:ring-orange-300 transition-all px-5 py-2",children:[A===s.id?e.jsx(u,{className:"animate-spin w-4 h-4 mr-2"}):null,"Refuser"]})]})]})},s.id);var o}))}),B.open&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"accept"===B.action?"Accepter la demande":"Refuser la demande"}),e.jsx(p,{htmlFor:"comment",children:"Commentaire (optionnel)"}),e.jsx(h,{id:"comment",value:R,onChange:e=>U(e.target.value),placeholder:"Ajouter un commentaire...",className:"mb-4"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>{z({open:!1,requestId:null,action:null}),U("")},children:"Annuler"}),e.jsx(m,{onClick:async()=>{"accept"===B.action?await(async(e,s="")=>{I(e);try{const a=localStorage.getItem("token"),r=await fetch(`/api/formation-requests/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:!0,comment:s})}),l=await r.json();r.ok?(x.success("Demande acceptée"),H()):x.error(l.message||"Erreur lors de l'acceptation")}catch(a){x.error("Erreur lors de l'acceptation")}finally{I(null)}})(B.requestId,R):await(async(e,s="")=>{I(e);try{const a=localStorage.getItem("token"),r=await fetch(`/api/formation-requests/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({status:!1,comment:s})}),l=await r.json();r.ok?(x.success("Demande refusée"),H()):x.error(l.message||"Erreur lors du refus")}catch(a){x.error("Erreur lors du refus")}finally{I(null)}})(B.requestId,R),z({open:!1,requestId:null,action:null}),U("")},disabled:A===B.requestId,children:"Confirmer"})]})]})})]})}export{v as default};
