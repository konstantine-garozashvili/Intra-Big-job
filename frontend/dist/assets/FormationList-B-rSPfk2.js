import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,R as r}from"./router-D7BdrHDj.js";import{w as a,o as t,p as i,q as n,B as o,s as l,ah as d,ag as c,al as m,ay as u,D as h,j as x,F as p,k as j,G as g,t as f}from"./index-DebaQ5DR.js";import{T as v,a as y,b as N,c as b,d as w,e as C}from"./table-DA0WkTUP.js";import{I as S}from"./input-yrlpNTQq.js";import{L as E}from"./label-qo7Ed_zZ.js";import{C as F}from"./checkbox-DggxesrR.js";import{L as k}from"./loader-circle-CI5eK5B9.js";import{P as A}from"./plus-DfsnoQgt.js";import{C as z}from"./chevron-up-BjFsURpo.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";const $={getAllFormations:async()=>await a.get("/formations"),getFormationById:async e=>await a.get(`/formations/${e}`),async createFormation(e){const s=await a.post("/formations",e);return!1===s.success?s:{id:s.id,name:s.name,promotion:s.promotion,description:s.description,students:s.students||[]}},async addStudentToFormation(e,s){const r=await a.post(`/formations/${e}/students`,{studentId:s});return!1===r.success?r:{success:!0,message:"Student added successfully"}},getFormationStudents:async e=>await a.get(`/formations/${e}/students`),getAvailableStudents:async e=>await a.get("/formations/available-students",{params:{formationId:e}})},P=()=>{const[a,P]=s.useState([]),[D,I]=s.useState(!1),[T,q]=s.useState(!1),[L,B]=s.useState(null),[G,O]=s.useState([]),[V,R]=s.useState([]),[H,J]=s.useState(!0),[K,M]=s.useState(!1),[Q,U]=s.useState(null),[W,X]=s.useState({name:"",promotion:"",description:""});s.useEffect((()=>{(async()=>{try{await Y()}catch(e){console.error("Error initializing:",e),f.error("Erreur lors de l'initialisation")}})()}),[]);const Y=async()=>{try{J(!0);const e=await $.getAllFormations();if(!1===e.success)return void f.error(e.message||"Erreur lors du chargement des formations");P(e)}catch(e){console.error("Erreur lors du chargement des formations:",e),f.error("Erreur lors du chargement des formations")}finally{J(!1)}},Z=()=>{I(!1),B(null),O([]),R([])},_=()=>{q(!1),X({name:"",promotion:"",description:""})};return H?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(k,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(n,{className:"text-2xl font-bold",children:"Gestion des Formations"}),e.jsxs(o,{onClick:()=>q(!0),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Créer une formation"]})]}),e.jsx(l,{children:e.jsxs(v,{children:[e.jsx(y,{children:e.jsxs(N,{children:[e.jsx(b,{children:"Nom de la formation"}),e.jsx(b,{children:"Promotion"}),e.jsx(b,{children:"Étudiants"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(w,{children:a.map((s=>e.jsxs(r.Fragment,{children:[e.jsxs(N,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>{return e=s.id,void U(Q===e?null:e);var e},children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[Q===s.id?e.jsx(z,{className:"w-4 h-4 mr-2"}):e.jsx(d,{className:"w-4 h-4 mr-2"}),s.name]})}),e.jsx(C,{children:s.promotion}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),e.jsxs(m,{variant:"secondary",children:[s.students.length," étudiants"]})]})}),e.jsx(C,{className:"text-right",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{B(e);try{const s=await $.getAvailableStudents(e.id);if(!1===s.success)return void f.error(s.message||"Erreur lors du chargement des étudiants disponibles");R(s),O([]),I(!0)}catch(s){console.error("Erreur lors du chargement des étudiants disponibles:",s),f.error("Erreur lors du chargement des étudiants disponibles")}})(s)},children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Ajouter des étudiants"]})})]}),Q===s.id&&e.jsx(N,{children:e.jsx(C,{colSpan:4,className:"bg-gray-50 p-4",children:e.jsxs("div",{className:"space-y-4",children:[s.description&&e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Description de la formation :"}),e.jsx("p",{className:"text-gray-600 text-sm whitespace-pre-wrap",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Liste des étudiants inscrits :"}),s.students.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:s.students.map((s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white rounded-md shadow-sm",children:[e.jsx(c,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[s.firstName," ",s.lastName]})]},s.id)))}):e.jsx("p",{className:"text-gray-500 italic",children:"Aucun étudiant inscrit"})]})]})})})]},s.id)))})]})})]}),e.jsx(h,{open:D,onOpenChange:I,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(j,{children:["Ajouter des étudiants à ",L?.name]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-4",children:V.map((s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:`student-${s.id}`,checked:G.includes(s.id),onCheckedChange:()=>{return e=s.id,void O((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]));var e}}),e.jsxs("label",{htmlFor:`student-${s.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.firstName," ",s.lastName]})]},s.id)))})}),e.jsxs(g,{children:[e.jsx(o,{variant:"outline",onClick:Z,children:"Annuler"}),e.jsx(o,{onClick:async()=>{if(0!==G.length&&L)try{const e=G.map((e=>$.addStudentToFormation(L.id,e)));await Promise.all(e),P((e=>e.map((e=>{if(e.id===L.id){const s=V.filter((e=>G.includes(e.id)));return{...e,students:[...e.students,...s]}}return e})))),f.success("Étudiants ajoutés avec succès"),Z()}catch(e){console.error("Erreur lors de l'ajout des étudiants:",e),f.error("Erreur lors de l'ajout des étudiants")}else f.error("Veuillez sélectionner au moins un étudiant")},children:"Ajouter les étudiants"})]})]})}),e.jsx(h,{open:T,onOpenChange:q,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(j,{children:"Créer une nouvelle formation"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),W.name&&W.promotion)try{M(!0);const e=await $.createFormation(W);if(!1===e.success)return void f.error(e.message||"Erreur lors de la création de la formation");P((s=>[...s,e])),f.success("Formation créée avec succès"),_(),X({name:"",promotion:"",description:""})}catch(s){console.error("Erreur lors de la création de la formation:",s),f.error("Erreur lors de la création de la formation")}finally{M(!1)}else f.error("Veuillez remplir tous les champs")},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"name",children:"Nom de la formation"}),e.jsx(S,{id:"name",value:W.name,onChange:e=>X((s=>({...s,name:e.target.value}))),placeholder:"Entrez le nom de la formation",disabled:K})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"promotion",children:"Promotion"}),e.jsx(S,{id:"promotion",value:W.promotion,onChange:e=>X((s=>({...s,promotion:e.target.value}))),placeholder:"Entrez la promotion",disabled:K})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:W.description,onChange:e=>X((s=>({...s,description:e.target.value}))),placeholder:"Entrez une description (optionnel)",disabled:K})]})]}),e.jsxs(g,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:_,disabled:K,children:"Annuler"}),e.jsx(o,{type:"submit",disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Création en cours..."]}):"Créer la formation"})]})]})]})})]})};export{P as default};
