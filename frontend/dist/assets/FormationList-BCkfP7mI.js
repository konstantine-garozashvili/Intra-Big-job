import{j as e}from"./ui-BA4EFhcy.js";import{r as s,R as r}from"./router-D7BdrHDj.js";import{v as a,n as t,o as i,p as n,B as o,r as l,ag as d,af as c,ak as m,ax as u,D as h,i as x,E as p,j,F as f,t as g}from"./index-BEnD5PKc.js";import{T as v,a as N,b,c as y,d as w,e as C}from"./table-DeEUOaDD.js";import{I as E}from"./input-YmQ-4tS3.js";import{L as S}from"./label-Bw9z97BO.js";import{C as F}from"./checkbox-CdabnS_2.js";import{L as k}from"./loader-circle-9ohH7lMW.js";import{P as A}from"./plus-BFbIkUyL.js";import{C as z}from"./chevron-up-CVC6Wqjx.js";import"./react-0RZ2pslC.js";import"./query-DhYyLX5-.js";import"./charts-DkICKEBk.js";const $={getAllFormations:async()=>await a.get("/formations"),getFormationById:async e=>await a.get(`/formations/${e}`),async createFormation(e){const s=await a.post("/formations",e);return!1===s.success?s:{id:s.id,name:s.name,promotion:s.promotion,description:s.description,students:s.students||[]}},async addStudentToFormation(e,s){const r=await a.post(`/formations/${e}/students`,{studentId:s});return!1===r.success?r:{success:!0,message:"Student added successfully"}},getFormationStudents:async e=>await a.get(`/formations/${e}/students`),getAvailableStudents:async e=>await a.get("/formations/available-students",{params:{formationId:e}})},P=()=>{const[a,P]=s.useState([]),[D,I]=s.useState(!1),[T,L]=s.useState(!1),[q,B]=s.useState(null),[O,V]=s.useState([]),[G,R]=s.useState([]),[H,J]=s.useState(!0),[K,M]=s.useState(!1),[Q,U]=s.useState(null),[W,X]=s.useState({name:"",promotion:"",description:""});s.useEffect((()=>{(async()=>{try{await Y()}catch(e){console.error("Error initializing:",e),g.error("Erreur lors de l'initialisation")}})()}),[]);const Y=async()=>{try{J(!0);const e=await $.getAllFormations();if(!1===e.success)return void g.error(e.message||"Erreur lors du chargement des formations");P(e)}catch(e){console.error("Erreur lors du chargement des formations:",e),g.error("Erreur lors du chargement des formations")}finally{J(!1)}},Z=()=>{I(!1),B(null),V([]),R([])},_=()=>{L(!1),X({name:"",promotion:"",description:""})};return H?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(k,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(n,{className:"text-2xl font-bold",children:"Gestion des Formations"}),e.jsxs(o,{onClick:()=>L(!0),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Créer une formation"]})]}),e.jsx(l,{children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(y,{children:"Nom de la formation"}),e.jsx(y,{children:"Promotion"}),e.jsx(y,{children:"Étudiants"}),e.jsx(y,{className:"text-right",children:"Actions"})]})}),e.jsx(w,{children:a.map((s=>e.jsxs(r.Fragment,{children:[e.jsxs(b,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>{return e=s.id,void U(Q===e?null:e);var e},children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[Q===s.id?e.jsx(z,{className:"w-4 h-4 mr-2"}):e.jsx(d,{className:"w-4 h-4 mr-2"}),s.name]})}),e.jsx(C,{children:s.promotion}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),e.jsxs(m,{variant:"secondary",children:[s.students.length," étudiants"]})]})}),e.jsx(C,{className:"text-right",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{B(e);try{const s=await $.getAvailableStudents(e.id);if(!1===s.success)return void g.error(s.message||"Erreur lors du chargement des étudiants disponibles");R(s),V([]),I(!0)}catch(s){console.error("Erreur lors du chargement des étudiants disponibles:",s),g.error("Erreur lors du chargement des étudiants disponibles")}})(s)},children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Ajouter des étudiants"]})})]}),Q===s.id&&e.jsx(b,{children:e.jsx(C,{colSpan:4,className:"bg-gray-50 p-4",children:e.jsxs("div",{className:"space-y-4",children:[s.description&&e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Description de la formation :"}),e.jsx("p",{className:"text-gray-600 text-sm whitespace-pre-wrap",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Liste des étudiants inscrits :"}),s.students.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:s.students.map((s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white rounded-md shadow-sm",children:[e.jsx(c,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[s.firstName," ",s.lastName]})]},s.id)))}):e.jsx("p",{className:"text-gray-500 italic",children:"Aucun étudiant inscrit"})]})]})})})]},s.id)))})]})})]}),e.jsx(h,{open:D,onOpenChange:I,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(j,{children:["Ajouter des étudiants à ",q?.name]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-4",children:G.map((s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:`student-${s.id}`,checked:O.includes(s.id),onCheckedChange:()=>{return e=s.id,void V((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]));var e}}),e.jsxs("label",{htmlFor:`student-${s.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.firstName," ",s.lastName]})]},s.id)))})}),e.jsxs(f,{children:[e.jsx(o,{variant:"outline",onClick:Z,children:"Annuler"}),e.jsx(o,{onClick:async()=>{if(0!==O.length&&q)try{const e=O.map((e=>$.addStudentToFormation(q.id,e)));await Promise.all(e),P((e=>e.map((e=>{if(e.id===q.id){const s=G.filter((e=>O.includes(e.id)));return{...e,students:[...e.students,...s]}}return e})))),g.success("Étudiants ajoutés avec succès"),Z()}catch(e){console.error("Erreur lors de l'ajout des étudiants:",e),g.error("Erreur lors de l'ajout des étudiants")}else g.error("Veuillez sélectionner au moins un étudiant")},children:"Ajouter les étudiants"})]})]})}),e.jsx(h,{open:T,onOpenChange:L,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(j,{children:"Créer une nouvelle formation"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),W.name&&W.promotion)try{M(!0);const e=await $.createFormation(W);if(!1===e.success)return void g.error(e.message||"Erreur lors de la création de la formation");P((s=>[...s,e])),g.success("Formation créée avec succès"),_(),X({name:"",promotion:"",description:""})}catch(s){console.error("Erreur lors de la création de la formation:",s),g.error("Erreur lors de la création de la formation")}finally{M(!1)}else g.error("Veuillez remplir tous les champs")},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"name",children:"Nom de la formation"}),e.jsx(E,{id:"name",value:W.name,onChange:e=>X((s=>({...s,name:e.target.value}))),placeholder:"Entrez le nom de la formation",disabled:K})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"promotion",children:"Promotion"}),e.jsx(E,{id:"promotion",value:W.promotion,onChange:e=>X((s=>({...s,promotion:e.target.value}))),placeholder:"Entrez la promotion",disabled:K})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(S,{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:W.description,onChange:e=>X((s=>({...s,description:e.target.value}))),placeholder:"Entrez une description (optionnel)",disabled:K})]})]}),e.jsxs(f,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:_,disabled:K,children:"Annuler"}),e.jsx(o,{type:"submit",disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Création en cours..."]}):"Créer la formation"})]})]})]})})]})};export{P as default};
