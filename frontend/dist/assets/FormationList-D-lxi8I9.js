import{j as e}from"./ui-CEgDFHEN.js";import{r as s,b as r}from"./router-Cgxi-4fo.js";import{y as a,q as t,r as i,s as n,B as o,w as l,as as d,ar as c,ax as m,aK as u,D as h,k as x,I as p,l as j,J as f,t as g}from"./index-BnANEtVp.js";import{T as v,a as b,b as y,c as N,d as w,e as C}from"./table-DS2AyS3B.js";import{I as S}from"./input-DQoClNUI.js";import{L as E}from"./label-T_DAMYbi.js";import{C as F}from"./checkbox-DB6Fdzbi.js";import{L as k}from"./loader-circle-tYz9PP6p.js";import{P as A}from"./plus-DuVqBw9_.js";import{C as z}from"./chevron-up-CiMjz0RO.js";import"./react-0RZ2pslC.js";import"./query-CdiCT4_A.js";import"./charts-D4j3G6dB.js";const I={getAllFormations:async()=>await a.get("/formations"),getFormationById:async e=>await a.get(`/formations/${e}`),async createFormation(e){const s=await a.post("/formations",e);return!1===s.success?s:{id:s.id,name:s.name,promotion:s.promotion,description:s.description,students:s.students||[]}},async addStudentToFormation(e,s){const r=await a.post(`/formations/${e}/students`,{studentId:s});return!1===r.success?r:{success:!0,message:"Student added successfully"}},getFormationStudents:async e=>await a.get(`/formations/${e}/students`),getAvailableStudents:async e=>await a.get("/formations/available-students",{params:{formationId:e}})},P=()=>{const[a,P]=s.useState([]),[$,D]=s.useState(!1),[L,T]=s.useState(!1),[V,q]=s.useState(null),[B,O]=s.useState([]),[G,J]=s.useState([]),[K,H]=s.useState(!0),[M,Q]=s.useState(!1),[R,U]=s.useState(null),[W,X]=s.useState({name:"",promotion:"",description:""});s.useEffect((()=>{(async()=>{try{await Y()}catch(e){console.error("Error initializing:",e),g.error("Erreur lors de l'initialisation")}})()}),[]);const Y=async()=>{try{H(!0);const e=await I.getAllFormations();if(!1===e.success)return void g.error(e.message||"Erreur lors du chargement des formations");P(e)}catch(e){console.error("Erreur lors du chargement des formations:",e),g.error("Erreur lors du chargement des formations")}finally{H(!1)}},Z=()=>{D(!1),q(null),O([]),J([])},_=()=>{T(!1),X({name:"",promotion:"",description:""})};return K?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(k,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(t,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsx(n,{className:"text-2xl font-bold",children:"Gestion des Formations"}),e.jsxs(o,{onClick:()=>T(!0),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Créer une formation"]})]}),e.jsx(l,{children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(y,{children:[e.jsx(N,{children:"Nom de la formation"}),e.jsx(N,{children:"Promotion"}),e.jsx(N,{children:"Étudiants"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(w,{children:a.map((s=>e.jsxs(r.Fragment,{children:[e.jsxs(y,{className:"cursor-pointer hover:bg-gray-50",onClick:()=>{return e=s.id,void U(R===e?null:e);var e},children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center",children:[R===s.id?e.jsx(z,{className:"w-4 h-4 mr-2"}):e.jsx(d,{className:"w-4 h-4 mr-2"}),s.name]})}),e.jsx(C,{children:s.promotion}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),e.jsxs(m,{variant:"secondary",children:[s.students.length," étudiants"]})]})}),e.jsx(C,{className:"text-right",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),(async e=>{q(e);try{const s=await I.getAvailableStudents(e.id);if(!1===s.success)return void g.error(s.message||"Erreur lors du chargement des étudiants disponibles");J(s),O([]),D(!0)}catch(s){console.error("Erreur lors du chargement des étudiants disponibles:",s),g.error("Erreur lors du chargement des étudiants disponibles")}})(s)},children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Ajouter des étudiants"]})})]}),R===s.id&&e.jsx(y,{children:e.jsx(C,{colSpan:4,className:"bg-gray-50 p-4",children:e.jsxs("div",{className:"space-y-4",children:[s.description&&e.jsxs("div",{className:"bg-white p-3 rounded-md shadow-sm",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Description de la formation :"}),e.jsx("p",{className:"text-gray-600 text-sm whitespace-pre-wrap",children:s.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-2",children:"Liste des étudiants inscrits :"}),s.students.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:s.students.map((s=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-white rounded-md shadow-sm",children:[e.jsx(c,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[s.firstName," ",s.lastName]})]},s.id)))}):e.jsx("p",{className:"text-gray-500 italic",children:"Aucun étudiant inscrit"})]})]})})})]},s.id)))})]})})]}),e.jsx(h,{open:$,onOpenChange:D,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(j,{children:["Ajouter des étudiants à ",V?.name]})}),e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-4",children:G.map((s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{id:`student-${s.id}`,checked:B.includes(s.id),onCheckedChange:()=>{return e=s.id,void O((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]));var e}}),e.jsxs("label",{htmlFor:`student-${s.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:[s.firstName," ",s.lastName]})]},s.id)))})}),e.jsxs(f,{children:[e.jsx(o,{variant:"outline",onClick:Z,children:"Annuler"}),e.jsx(o,{onClick:async()=>{if(0!==B.length&&V)try{const e=B.map((e=>I.addStudentToFormation(V.id,e)));await Promise.all(e),P((e=>e.map((e=>{if(e.id===V.id){const s=G.filter((e=>B.includes(e.id)));return{...e,students:[...e.students,...s]}}return e})))),g.success("Étudiants ajoutés avec succès"),Z()}catch(e){console.error("Erreur lors de l'ajout des étudiants:",e),g.error("Erreur lors de l'ajout des étudiants")}else g.error("Veuillez sélectionner au moins un étudiant")},children:"Ajouter les étudiants"})]})]})}),e.jsx(h,{open:L,onOpenChange:T,children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(j,{children:"Créer une nouvelle formation"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),W.name&&W.promotion)try{Q(!0);const e=await I.createFormation(W);if(!1===e.success)return void g.error(e.message||"Erreur lors de la création de la formation");P((s=>[...s,e])),g.success("Formation créée avec succès"),_(),X({name:"",promotion:"",description:""})}catch(s){console.error("Erreur lors de la création de la formation:",s),g.error("Erreur lors de la création de la formation")}finally{Q(!1)}else g.error("Veuillez remplir tous les champs")},children:[e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"name",children:"Nom de la formation"}),e.jsx(S,{id:"name",value:W.name,onChange:e=>X((s=>({...s,name:e.target.value}))),placeholder:"Entrez le nom de la formation",disabled:M})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"promotion",children:"Promotion"}),e.jsx(S,{id:"promotion",value:W.promotion,onChange:e=>X((s=>({...s,promotion:e.target.value}))),placeholder:"Entrez la promotion",disabled:M})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:W.description,onChange:e=>X((s=>({...s,description:e.target.value}))),placeholder:"Entrez une description (optionnel)",disabled:M})]})]}),e.jsxs(f,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:_,disabled:M,children:"Annuler"}),e.jsx(o,{type:"submit",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4 mr-2 animate-spin"}),"Création en cours..."]}):"Créer la formation"})]})]})]})})]})};export{P as default};
