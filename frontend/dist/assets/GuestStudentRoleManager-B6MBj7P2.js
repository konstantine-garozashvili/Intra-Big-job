import{j as e}from"./ui-B5ZVMT00.js";import{r as s}from"./router-Cgxi-4fo.js";import{t as r,a_ as n,q as a,r as t,s as i,v as o,w as l,L as c,a$ as d,B as m,b as u,D as h,k as x,I as j,l as p,n as g,J as v}from"./index-B8gHVj-n.js";import{u as f,b as N,a as E}from"./query-DUefEkVx.js";import{T as C,a as S,b as L,c as T,d as U,e as b}from"./table-Dh3GOIB4.js";import{C as y}from"./checkbox-DPW43kYo.js";import{D as G}from"./DashboardLayout-C7fFAJWO.js";import"./label-BEOEvXdk.js";import"./react-0RZ2pslC.js";import"./charts-D4j3G6dB.js";import"./circle-alert-BViBeMBH.js";const w=n.create({baseURL:"http://localhost:5173/api"});w.interceptors.request.use((e=>{const s=localStorage.getItem("token");return s&&(e.headers.Authorization=`Bearer ${s}`),e}));const k="/users",R="/user-roles/change-role",$=({open:s,onOpenChange:r,user:n,onConfirm:a,isProcessing:t})=>{const i=n?.roles?.some((e=>"GUEST"===e.name||"ROLE_GUEST"===e.name));return e.jsx(h,{open:s,onOpenChange:r,children:e.jsxs(x,{children:[e.jsxs(j,{children:[e.jsx(p,{children:"Confirmation du changement de rôle"}),e.jsx(g,{children:i?`Êtes-vous sûr de vouloir promouvoir ${n?.firstName} ${n?.lastName} en tant qu'élève ?`:`Êtes-vous sûr de vouloir rétrograder ${n?.firstName} ${n?.lastName} en tant qu'invité ?`})]}),e.jsxs(v,{children:[e.jsx(m,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsxs(m,{onClick:a,disabled:t,children:[t?e.jsx(c,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Confirmer"]})]})]})})};function O(){const n=f(),[h,x]=s.useState(null),[j,p]=s.useState(!1),[g,v]=s.useState({guest:!0,student:!1}),[O,q]=s.useState(1),[_,D]=s.useState([]),{data:I=[],isLoading:P}=N({queryKey:["guest-student-users",g],queryFn:async()=>{try{const e=await w.get(k);if(e.data.success){return(e.data.data||[]).filter((e=>{const s=e.roles.map((e=>e.name));return!(!g.guest||!s.includes("GUEST"))||!(!g.student||!s.includes("STUDENT"))}))}return[]}catch(e){return console.error("Error fetching users:",e),r.error("Erreur lors de la récupération des utilisateurs"),[]}}}),z=E({mutationFn:async e=>{const s=e.roles.some((e=>"GUEST"===e.name||"ROLE_GUEST"===e.name))?"ROLE_STUDENT":"ROLE_GUEST";return w.post(R,{userId:e.id,newRole:s})},onSuccess:(e,s)=>{const a=s.roles.some((e=>"GUEST"===e.name||"ROLE_GUEST"===e.name));r.success(a?`${s.firstName} ${s.lastName} a été promu en élève`:`${s.firstName} ${s.lastName} a été rétrogradé en invité`),n.invalidateQueries(["guest-student-users"]),p(!1)},onError:e=>{console.error("Error changing role:",e),r.error("Une erreur est survenue lors du changement de rôle")}}),A=s.useMemo((()=>{const e=10*(O-1),s=e+10;return I.slice(e,s)}),[I,O]);return s.useEffect((()=>{(()=>{const e=u.getUser(),s=e?.roles?.some((e=>"string"==typeof e?e.toLowerCase().includes("recruiter"):(e.name||e.role||"").toLowerCase().includes("recruiter"))),n=e?.roles?.some((e=>"string"==typeof e?e.toLowerCase().includes("admin")||e.toLowerCase().includes("superadmin"):(e.name||e.role||"").toLowerCase().includes("admin")));s||n||r.error("Vous n'avez pas les droits pour accéder à cette page")})()}),[]),s.useEffect((()=>{I&&D(I)}),[I]),e.jsxs(G,{children:[e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs(a,{children:[e.jsxs(t,{children:[e.jsx(i,{children:"Gestion des rôles Invité/Élève"}),e.jsx(o,{children:"Gérez la promotion des invités en élèves et la rétrogradation des élèves en invités"})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"invites",checked:g.guest,onCheckedChange:e=>v((s=>({...s,guest:e})))}),e.jsx("label",{htmlFor:"invites",children:"Invités"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{id:"eleves",checked:g.student,onCheckedChange:e=>v((s=>({...s,student:e})))}),e.jsx("label",{htmlFor:"eleves",children:"Élèves"})]}),e.jsxs("div",{className:"ml-auto flex items-center space-x-2",children:[e.jsx("span",{children:"Éléments par page:"}),e.jsx("select",{className:"border rounded p-1",value:10,disabled:!0,children:e.jsx("option",{value:10,children:"10"})}),e.jsxs("span",{children:["Affichage de ",A.length," sur ",_.length," utilisateurs"]})]})]}),e.jsxs(C,{children:[e.jsx(S,{children:e.jsxs(L,{children:[e.jsx(T,{className:"w-[200px]",children:"Nom ↑"}),e.jsx(T,{children:"Prénom"}),e.jsx(T,{children:"Email"}),e.jsx(T,{children:"Rôles actuels"}),e.jsx(T,{className:"text-right",children:"Actions"})]})}),e.jsx(U,{children:P?e.jsx(L,{children:e.jsx(b,{colSpan:5,className:"text-center py-4",children:e.jsx(c,{className:"w-6 h-6 animate-spin mx-auto"})})}):A.map((s=>e.jsxs(L,{children:[e.jsx(b,{children:s.lastName}),e.jsx(b,{children:s.firstName}),e.jsx(b,{children:s.email}),e.jsx(b,{children:s.roles.map((s=>e.jsx(d,{role:s.name,className:"mr-1"},s.id||s.name)))}),e.jsx(b,{className:"text-right",children:e.jsx(m,{variant:"outline",onClick:()=>{x(s),p(!0)},children:s.roles.some((e=>"GUEST"===e.name||"ROLE_GUEST"===e.name))?"Promouvoir en élève":"Rétrograder en invité"})})]},s.id)))})]})]})]})}),e.jsx($,{open:j,onOpenChange:p,user:h,onConfirm:()=>z.mutate(h),isProcessing:z.isPending})]})}export{O as default};
