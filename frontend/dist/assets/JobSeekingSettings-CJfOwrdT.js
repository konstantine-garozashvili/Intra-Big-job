import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,R as t}from"./router-D7BdrHDj.js";import{Y as a,t as r,B as l,S as n,a4 as i,a1 as c,V as o,D as d,j as m,F as u,k as p,l as x,G as h,a5 as f,m as g,a6 as j,Q as v,a7 as b,L as y}from"./index-BMLMJrKU.js";import{I as N}from"./input-BRyAHfiB.js";import{P as w}from"./phone-input-BqitBteO.js";import{L as C}from"./label-hQz2gHLy.js";import{L as k}from"./loader-circle-BdwTX8h9.js";import{D as E}from"./download-D_lm4U0X.js";import{T as D}from"./trash-2-DtCel-MX.js";import{C as S}from"./circle-alert-BcgKqbFs.js";import{a as U}from"./switch-B9-AHqaP.js";
/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=a("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),z=a("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),R=a("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),P=e=>{if(!e)return"";return e.replace(/\D/g,"").replace(/(\d{2})(?=\d)/g,"$1 ").trim()},L=s.memo((({field:a,label:c,icon:o,value:d,type:m="text",isEditing:u,isEditable:p,editedValue:x,onEdit:h,onSave:f,onCancel:g,onChange:j,className:v="",loading:b=!1})=>{const[y,E]=s.useState(d),[D,S]=s.useState(null);s.useEffect((()=>{u||(E(d),S(null),j&&"url"===m&&!u&&j(d))}),[d,u,j,m]);const U=u?x:y||d,A=t.useCallback((async()=>{try{if("url"===m&&x&&!x.startsWith("https://"))return S("L'URL doit commencer par https://"),void r.error("L'URL doit commencer par https://");E(x),h&&h(),await f(a),S(null),"linkedinUrl"===a&&document.dispatchEvent(new CustomEvent("user:data-updated"))}catch(e){E(d),S(e.response?.data?.message||"Une erreur est survenue"),r.error(e.response?.data?.message||"Une erreur est survenue")}}),[f,a,x,h,d,m]);return e.jsxs("div",{className:`\n        rounded-lg transition-all duration-200 \n        ${u?"bg-white border-2 border-blue-200 shadow-sm":"bg-gray-50"} \n        ${u?"":"hover:bg-gray-100"} \n        p-3 sm:p-4 md:p-5 \n        ${v}\n      `,children:[e.jsxs(C,{className:"text-xs sm:text-sm font-medium text-gray-700 flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[o,c]}),p&&!u&&e.jsx(l,{variant:"ghost",size:"sm",onClick:h,className:"h-7 w-7 p-1 text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors",disabled:b,children:e.jsx(z,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]}),u?e.jsxs("div",{className:"mt-2 space-y-2",children:["phone"===m?e.jsx(w,{value:x,onChange:j,className:"w-full",disabled:b}):e.jsx(N,{type:m,value:x,onChange:e=>j(e.target.value),className:"w-full "+(D?"border-red-500":""),disabled:b,placeholder:"url"===m?"https://...":""}),D&&e.jsx("p",{className:"text-sm text-red-500",children:D}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:g,disabled:b,children:"Annuler"}),e.jsx(l,{size:"sm",onClick:A,disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):"Enregistrer"})]})]}):e.jsx("div",{className:"mt-1 min-h-[1.5rem]",children:b?e.jsx(n,{className:"h-5 w-full"}):U?"url"===m?e.jsxs("a",{href:U,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 break-all group",children:[e.jsx("span",{className:"truncate mr-1",children:(R=U,R?R.length>40?R.substring(0,37)+"...":R:"")}),e.jsx(i,{className:"h-3 w-3 opacity-70 group-hover:opacity-100 flex-shrink-0"})]}):e.jsx("span",{className:"text-gray-900",children:"phone"===m&&U?P(U):U}):e.jsx("span",{className:"text-gray-500",children:"Non renseigné"})})]});var R}),((e,s)=>e.value===s.value&&e.isEditing===s.isEditing&&e.editedValue===s.editedValue&&e.loading===s.loading));L.displayName="EditableField";const V=e=>!!e&&(Array.isArray(e)?e.some((e=>{const s="object"==typeof e&&null!==e?e.name:e;return"ROLE_ADMIN"===s||"ADMIN"===s})):"ROLE_ADMIN"===e||"ADMIN"===e),F=e=>!!e&&(Array.isArray(e)?e.some((e=>{const s="object"==typeof e&&null!==e?e.name:e;return"ROLE_SUPER_ADMIN"===s||"SUPER_ADMIN"===s||"SUPERADMIN"===s})):"ROLE_SUPER_ADMIN"===e||"SUPER_ADMIN"===e||"SUPERADMIN"===e),M=e=>!!e&&(Array.isArray(e)?e.some((e=>{const s="object"==typeof e&&null!==e?e.name:e;return"ROLE_STUDENT"===s||"STUDENT"===s})):"ROLE_STUDENT"===e||"STUDENT"===e),O=e=>!!e&&(Array.isArray(e)?e.some((e=>{const s="object"==typeof e&&null!==e?e.name:e;return"ROLE_GUEST"===s||"GUEST"===s})):"ROLE_GUEST"===e||"GUEST"===e),T=e=>V(e)||F(e),I=e=>V(e)||M(e)||O(e)||F(e),_=s.memo((({userData:t,onUpdate:a})=>{const[n,i]=s.useState(null),[v,b]=s.useState(!1),[y,N]=s.useState(null),[w,C]=s.useState(!1),{data:k,isLoading:U,refetch:z}=c("/api/documents/type/CV","userCVDocument",{refetchOnWindowFocus:!1,onError:e=>{console.error("Error fetching CV document:",e)}}),P=k?.data?.[0]||null,{mutate:L,isPending:V}=o("/api/documents/upload/cv","post","userCVDocument",{onSuccess:()=>{r.success("CV uploaded successfully"),i(null),z(),document.dispatchEvent(new CustomEvent("user:data-updated")),a&&a();const e=document.getElementById("cv-upload");e&&(e.value="")},onError:e=>{r.error("Failed to upload CV: "+(e.response?.data?.message||e.message))}}),{mutate:F,isPending:M}=o((e=>`/api/documents/${e}`),"delete","userCVDocument",{onSuccess:()=>{r.success("CV deleted successfully"),z(),document.dispatchEvent(new CustomEvent("user:data-updated")),a&&a()},onError:e=>{r.error("Failed to delete CV: "+(e.response?.data?.message||e.message))}}),O=s.useCallback((e=>{if(N(null),e.target.files&&e.target.files[0]){const s=e.target.files[0];if(s.size>10485760)return void N("File is too large. Maximum size is 10MB.");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))return void N("Unsupported file format. Please use PDF, DOC, or DOCX.");i(s)}}),[]),T=s.useCallback((()=>{if(!n)return void r.error("Please select a file");const e=new FormData;e.append("file",n),L(e)}),[n,L]),I=s.useCallback((()=>{P&&P.id?C(!0):r.error("No document to delete")}),[P]),_=s.useCallback((()=>{P&&P.id?(C(!1),F(P.id)):r.error("No document to delete")}),[P,F]),B=s.useCallback((async()=>{if(P&&P.id)try{const e=await fetch(`https://bigproject-development.konstantine.fr/api/documents/${P.id}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Failed to download document");const s=await e.blob(),t=window.URL.createObjectURL(s),a=document.createElement("a");a.style.display="none",a.href=t,a.download=P.name||"cv.pdf",document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a),r.success("Document téléchargé avec succès")}catch(e){console.error("Erreur lors du téléchargement du CV:",e),r.error("Erreur lors du téléchargement du CV")}else r.error("No document to download")}),[P]),$=s.useCallback((e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?b(!0):"dragleave"===e.type&&b(!1)}),[]),q=s.useCallback((e=>{if(e.preventDefault(),e.stopPropagation(),b(!1),N(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const s=e.dataTransfer.files[0];if(s.size>10485760)return void N("File is too large. Maximum size is 10MB.");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))return void N("Unsupported file format. Please use PDF, DOC, or DOCX.");i(s)}}),[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{open:w,onOpenChange:C,children:e.jsxs(m,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Confirmer la suppression"}),e.jsx(x,{children:"Êtes-vous sûr de vouloir supprimer votre CV ? Cette action est irréversible."})]}),e.jsxs(h,{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>C(!1),children:"Annuler"}),e.jsx(l,{variant:"destructive",onClick:_,disabled:M,children:M?"Suppression...":"Supprimer"})]})]})}),P&&e.jsx("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[e.jsx(f,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm sm:text-base truncate",children:P.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-gray-500",children:["Ajouté le ",new Date(P.createdAt).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full sm:w-auto gap-2 sm:gap-3",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:B,disabled:M,className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center",children:[e.jsx(E,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5"}),"Télécharger"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:I,disabled:M,className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center text-red-500 hover:text-red-700",children:[e.jsx(D,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5"}),"Supprimer"]})]})]})}),!P&&e.jsx("div",{className:"border-2 border-dashed rounded-lg p-3 sm:p-6 text-center "+(v?"border-blue-500 bg-blue-50":"border-gray-300"),onDragEnter:$,onDragOver:$,onDragLeave:$,onDrop:q,children:e.jsxs(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-2 sm:space-y-4",children:[e.jsx("div",{className:"mx-auto w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(R,{className:"h-4 w-4 sm:h-6 sm:w-6 text-blue-500"})}),e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-medium",children:"Déposez votre CV ici"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Glissez-déposez votre fichier ici, ou cliquez pour parcourir"})]}),e.jsxs("div",{children:[e.jsx("input",{id:"cv-upload",type:"file",accept:".pdf,.doc,.docx",onChange:O,className:"hidden"}),e.jsx(l,{variant:"outline",onClick:()=>document.getElementById("cv-upload").click(),className:"mx-auto text-xs sm:text-sm h-8 sm:h-9 px-3 sm:px-4",children:"Parcourir les fichiers"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Formats acceptés : PDF, DOC, DOCX (max 10MB)"})]})}),n&&!P&&e.jsx("div",{className:"mt-3 bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 w-full sm:w-auto",children:[e.jsx(A,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-xs sm:text-sm truncate",children:n.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(n.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx(l,{onClick:T,disabled:V,size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center",children:V?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5"}),"Envoyer"]})})]})}),y&&e.jsxs("div",{className:"mt-2 p-2 sm:p-3 bg-red-50 text-red-700 rounded-md flex items-start space-x-2",children:[e.jsx(S,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs sm:text-sm flex-1",children:y})]}),U&&!P&&!n&&e.jsx("div",{className:"text-center py-4 sm:py-6",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"rounded-full bg-gray-200 h-8 w-8 sm:h-10 sm:w-10"}),e.jsx("div",{className:"h-2 sm:h-3 bg-gray-200 rounded w-32 sm:w-40"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-24 sm:w-32"})]})})]})}));_.displayName="CVUpload";const B=s.memo((({profile:t,onProfileUpdate:a})=>{const[l,n]=s.useState(!1),[i,c]=s.useState(!1),[o,d]=s.useState(!1);s.useEffect((()=>{if(t)try{t.studentProfile?(c(Boolean(t.studentProfile.isSeekingInternship)),d(Boolean(t.studentProfile.isSeekingApprenticeship))):(c(Boolean(t.isSeekingInternship)),d(Boolean(t.isSeekingApprenticeship)))}catch(e){}}),[t]);const m=s.useCallback((async()=>{if(!l)try{n(!0);const e=!i;c(e);const s=await v.toggleInternshipSeeking(e);if(!s||!s.success)throw c(!e),new Error("Échec de la mise à jour");r.success("Recherche d'emploi "+(e?"activée":"désactivée"))}catch(e){console.error("Erreur lors de la mise à jour du statut de recherche de stage:",e),r.error("Une erreur est survenue lors de la mise à jour de votre statut de recherche")}finally{n(!1)}}),[l,i]),u=s.useCallback((async()=>{if(!l)try{n(!0);const e=!o;d(e);const s=await v.toggleApprenticeshipSeeking(e);if(!s||!s.success)throw d(!e),new Error("Échec de la mise à jour");r.success("Recherche d'alternance "+(e?"activée":"désactivée"))}catch(e){console.error("Erreur lors de la mise à jour du statut de recherche d'alternance:",e),r.error("Une erreur est survenue lors de la mise à jour de votre statut de recherche")}finally{n(!1)}}),[l,o]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("p",{className:"text-sm sm:text-base text-gray-600",children:["Activez ces options pour indiquer que vous êtes à la recherche d'un emploi et/ou d'une alternance.",e.jsx("strong",{className:"block mt-2 sm:mt-3",children:"Vous pouvez activer les deux options simultanément si vous êtes ouvert aux deux types d'opportunités."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 rounded-lg "+(i?"bg-blue-50 border border-blue-200":"bg-gray-50"),children:[e.jsxs("div",{className:"flex items-start sm:items-center space-x-3 mb-3 sm:mb-0",children:[e.jsx("div",{className:"p-2 rounded-full "+(i?"bg-blue-100":"bg-gray-100"),children:e.jsx(b,{className:"h-4 w-4 sm:h-5 sm:w-5 "+(i?"text-blue-600":"text-gray-500")})}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"seeking-internship",className:"text-sm sm:text-base font-medium",children:"Recherche d'emploi"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"Activez cette option si vous recherchez un emploi"})]})]}),e.jsx(U,{id:"seeking-internship",checked:i,onCheckedChange:m,disabled:l,className:"ml-0 sm:ml-4"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 rounded-lg "+(o?"bg-purple-50 border border-purple-200":"bg-gray-50"),children:[e.jsxs("div",{className:"flex items-start sm:items-center space-x-3 mb-3 sm:mb-0",children:[e.jsx("div",{className:"p-2 rounded-full "+(o?"bg-purple-100":"bg-gray-100"),children:e.jsx(y,{className:"h-4 w-4 sm:h-5 sm:w-5 "+(o?"text-purple-600":"text-gray-500")})}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"seeking-apprenticeship",className:"text-sm sm:text-base font-medium",children:"Recherche d'alternance"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:"Activez cette option si vous recherchez une alternance"})]})]}),e.jsx(U,{id:"seeking-apprenticeship",checked:o,onCheckedChange:u,disabled:l,className:"ml-0 sm:ml-4"})]}),(i||o)&&e.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-xs sm:text-sm text-green-800",children:[e.jsx("span",{className:"font-semibold",children:"Votre profil est visible"})," par les recruteurs et les entreprises partenaires. Assurez-vous que votre CV est à jour pour maximiser vos chances."]})})]})]})}));B.displayName="JobSeekingSettings";export{_ as C,L as E,B as J,z as P,R as U,I as a,M as b,T as c,O as d,P as f,V as i};
