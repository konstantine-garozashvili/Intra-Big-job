import{j as e}from"./ui-B5ZVMT00.js";import{r as s,b as t}from"./router-Cgxi-4fo.js";import{t as a,B as r,ac as n,a5 as i,a6 as l,a7 as c,ae as o,af as d,ag as m,aa as u,Z as p,D as x,k as h,I as g,l as f,n as b,J as j,ah as v,m as y,ai as N,aj as w,W as k,ak as C,R as E}from"./index-C8q69DJ6.js";import{I as D}from"./input-DkiX3ve4.js";import{P as S}from"./phone-input-B1dDwr-U.js";import{L as U}from"./label-bz4YyvVq.js";import{P as O}from"./pencil-63TXyuyV.js";import{f as T}from"./index-BSSCmaQq.js";import{D as V}from"./download-BzEHQ2cB.js";import{T as z}from"./trash-2-CoVkTDEs.js";import{U as P}from"./upload-D3fgMkEt.js";import{C as $}from"./circle-alert-hBDBViOt.js";import{S as L}from"./switch-DerWJSQv.js";const A=e=>{if(!e)return"";let s=e.toString().replace(/[^\d+]/g,"");if(s.startsWith("+33")){let e=s.substring(3);if(e.startsWith("0")&&(e=e.substring(1)),e=e.substring(0,9),e.length>0){let s=`+33 ${e.substring(0,1)}`;return e.length>1&&(s+=` ${e.substring(1,3)}`),e.length>3&&(s+=` ${e.substring(3,5)}`),e.length>5&&(s+=` ${e.substring(5,7)}`),e.length>7&&(s+=` ${e.substring(7,9)}`),s}return"+33"}if(s.startsWith("33")){let e=s.substring(2);if(e.startsWith("0")&&(e=e.substring(1)),e=e.substring(0,9),e.length>0){let s=`+33 ${e.substring(0,1)}`;return e.length>1&&(s+=` ${e.substring(1,3)}`),e.length>3&&(s+=` ${e.substring(3,5)}`),e.length>5&&(s+=` ${e.substring(5,7)}`),e.length>7&&(s+=` ${e.substring(7,9)}`),s}return"+33"}if(s.startsWith("0")){if(s=s.substring(0,10),s.length>=2){let e=s.substring(0,2);return s.length>2&&(e+=` ${s.substring(2,4)}`),s.length>4&&(e+=` ${s.substring(4,6)}`),s.length>6&&(e+=` ${s.substring(6,8)}`),s.length>8&&(e+=` ${s.substring(8,10)}`),e}return s}return s||e},F=s.memo((({field:n,label:i,icon:l,value:c,type:o="text",isEditing:d,isEditable:m,editedValue:u,onEdit:p,onSave:x,onCancel:h,onChange:g,className:f="",loading:b=!1,displayAsLink:j=!1})=>{const[v,y]=s.useState(c),[N,w]=s.useState(null),k=s.useRef(null);s.useEffect((()=>{if(d&&"url"===o&&k.current){const e=k.current;e.focus(),e.setSelectionRange(e.value.length,e.value.length)}}),[d,o]),s.useEffect((()=>{d||(y(c),w(null),g&&"url"===o&&!d&&g(c))}),[c,d,g,o]);const C=d?u:v||c,E=()=>"phone"===o&&C?A(C):C,T=t.useCallback((async()=>{try{if("url"===o&&u&&!u.startsWith("https://"))return w("L'URL doit commencer par https://"),void a.error("L'URL doit commencer par https://");y(u),p&&p(),await x(n),w(null),"linkedinUrl"===n&&document.dispatchEvent(new CustomEvent("user:data-updated"))}catch(e){y(c),w(e.response?.data?.message||"Une erreur est survenue"),a.error(e.response?.data?.message||"Une erreur est survenue")}}),[x,n,u,p,c,o]);return e.jsx("div",{className:`address-edit-card w-full ${f} flex flex-col justify-between`,children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[l&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("span",{className:"h-5 w-5 text-blue-500 flex items-center justify-center",children:l})}),e.jsx(U,{className:"text-sm font-semibold text-gray-700 p-0 m-0 leading-none",children:i})]}),e.jsxs("div",{className:"mt-1 space-y-2",children:["phone"===o?e.jsx(S,{value:u,onChange:g,className:"address-input w-full pl-10",disabled:b}):e.jsxs("div",{className:"relative mb-4",children:[e.jsx(D,{type:o,value:u,onChange:e=>g(e.target.value),className:`address-input w-full pl-10 ${N?"border-red-500":""} break-all`,disabled:b,placeholder:"url"===o?"https://...":"",ref:"url"===o?k:void 0}),l&&e.jsx("span",{className:"address-input-icon h-5 w-5 text-blue-500 flex items-center justify-center",children:l})]}),N&&e.jsx("p",{className:"text-sm text-red-500",children:N}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[e.jsx("button",{type:"button",className:"address-btn-secondary address-btn-compact",onClick:h,disabled:b,children:"Annuler"}),e.jsx("button",{type:"button",className:"address-btn-primary address-btn-compact",onClick:T,disabled:b,children:"Enregistrer"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("span",{className:"h-5 w-5 text-blue-500 flex items-center justify-center",children:l})}),e.jsx(U,{className:"text-sm font-semibold text-gray-700 p-0 m-0 leading-none",children:i}),m&&e.jsx(r,{variant:"ghost",size:"sm",className:"ml-auto text-blue-600 hover:text-blue-700 hover:bg-blue-50 transition-colors flex items-center justify-center",onClick:p,children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"mt-1 min-h-[2.2rem] flex items-center text-base text-gray-900 pl-0",children:j&&C?e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline break-all",children:E()}):e.jsx("span",{className:"break-all",children:E()||e.jsx("span",{className:"text-gray-400 italic",children:"Non renseigné"})})})]})})}),((e,s)=>e.value===s.value&&e.isEditing===s.isEditing&&e.editedValue===s.editedValue&&e.loading===s.loading&&e.displayAsLink===s.displayAsLink));F.displayName="EditableField";const R=e=>{if(!e)return"Non renseigné";try{const s=new Date(e);if(isNaN(s.getTime()))return"Date invalide";const t=6e4*s.getTimezoneOffset(),a=new Date(s.getTime()-t);return T(a,"dd MMMM yyyy",{locale:n})}catch(s){return"Date invalide"}},I=e=>{if(!e)return"Non renseignée";let s=[];return e.name&&s.push(e.name),e.complement&&s.push(e.complement),e.postalCode?.code&&s.push(e.postalCode.code),e.city?.name&&s.push(e.city.name),s.join(", ")||"Adresse incomplète"},M=s.memo((({label:s,icon:t,value:a,fieldType:r="text"})=>{const n=((e,s="text")=>"phone"===s&&e?A(e):e)(a,r);return e.jsxs("div",{className:"address-edit-card w-full flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t&&e.jsx("span",{className:"flex items-center justify-center",children:e.jsx("span",{className:"h-5 w-5 text-blue-500 flex items-center justify-center",children:t})}),e.jsx(U,{className:"text-sm font-semibold text-gray-700 p-0 m-0 leading-none",children:s})]}),e.jsx("div",{className:"mt-1 min-h-[2.2rem] flex items-center text-base text-gray-900 pl-0",children:e.jsx("span",{children:n})})]})})),B=["DOCUMENT_DELETED","DOCUMENT_REJECTED","DOCUMENT_APPROVED","DOCUMENT_UPLOADED"],_=async(e,s,t,a,r="/documents",n=!1)=>{if(n||!B.includes(s))try{let e=localStorage.getItem("userId")||localStorage.getItem("user_id");try{const s=localStorage.getItem("user");if(s){const t=JSON.parse(s);t&&t.id&&(e=t.id)}}catch(u){}if(!e)return;e=String(e);try{const n=i(l,"notificationPreferences",e),m=await c(n);if(!1===(m.data()||{})[s])return;const u={recipientId:e,title:t,message:a,type:s,targetUrl:r,timestamp:new Date,read:!1};await o(d(l,"notifications"),u)}catch(p){}const x=new Date,h={id:`local-${x.getTime()}`,title:t,message:a,type:s,targetUrl:r,timestamp:x,createdAt:x.toISOString(),read:!1};B.includes(s)&&!n||m.cache.notifications&&m.cache.notifications.notifications&&(m.cache.notifications.notifications.unshift(h),m.cache.unreadCount=(m.cache.unreadCount||0)+1,m.cache.notifications.pagination&&(m.cache.notifications.pagination.total+=1),m.notifySubscribers(),setTimeout((()=>{m.getNotifications(1,10,!0,!0).then((()=>{m.getUnreadCount(!0)})).catch((()=>{}))}),300))}catch(x){}},W=(e,s=null,t=!1)=>{const a=s||`Votre document ${e.name} a été supprimé avec succès.`;return _(0,"DOCUMENT_DELETED","Document supprimé",a,"/documents",t)},J=s.memo((({userData:t,onUpdate:n})=>{const[i,l]=s.useState(null),[c,o]=s.useState(!1),[d,m]=s.useState(null),[k,C]=s.useState(!1),{data:E,isLoading:D,refetch:S}=u("/api/documents/type/CV","userCVDocument",{refetchOnWindowFocus:!1,onError:e=>{console.error("Error fetching CV document:",e)}}),U=E?.data?.[0]||null,{mutate:O,isPending:T}=p("/api/documents/upload/cv","post","userCVDocument",{onSuccess:()=>{l(null),document.dispatchEvent(new CustomEvent("user:data-updated"));const e=document.getElementById("cv-upload");e&&(e.value="")},onError:e=>{a.error("Failed to upload CV: "+(e.response?.data?.message||e.message))}}),{mutate:L,isPending:A}=p((e=>`/api/documents/${e}`),"delete","userCVDocument",{onSuccess:()=>{a.success("CV deleted successfully"),S(),document.dispatchEvent(new CustomEvent("user:data-updated")),n&&n()},onError:e=>{a.error("Failed to delete CV: "+(e.response?.data?.message||e.message))}}),F=s.useCallback((e=>{if(m(null),e.target.files&&e.target.files[0]){const s=e.target.files[0];if(s.size>10485760)return void m("File is too large. Maximum size is 10MB.");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))return void m("Unsupported file format. Please use PDF, DOC, or DOCX.");l(s)}}),[]),R=s.useCallback((()=>{if(!i)return void a.error("Please select a file");const e=new FormData;e.append("file",i),O(e)}),[i,O]),I=s.useCallback((()=>{U&&U.id?C(!0):a.error("No document to delete")}),[U]),M=s.useCallback((()=>{if(!U||!U.id)return void a.error("No document to delete");C(!1);const e={id:U.id,name:U.name};L(U.id);const s=JSON.parse(localStorage.getItem("user")||"{}"),t=s?.roles?.includes("ROLE_STUDENT"),r=s?.roles?.includes("ROLE_GUEST");(t||r)&&W(e,null,!0)}),[U,L]),B=s.useCallback((async()=>{if(U&&U.id)try{const e=await fetch(`https://bigproject-development.konstantine.fr/api/documents/${U.id}/download`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Failed to download document");const s=await e.blob(),t=window.URL.createObjectURL(s),r=document.createElement("a");r.style.display="none",r.href=t,r.download=U.name||"cv.pdf",document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(t),document.body.removeChild(r),a.success("Document importé avec succès")}catch(e){a.error("Erreur lors du téléchargement du CV")}else a.error("No document to download")}),[U]),_=s.useCallback((e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?o(!0):"dragleave"===e.type&&o(!1)}),[]),J=s.useCallback((e=>{if(e.preventDefault(),e.stopPropagation(),o(!1),m(null),e.dataTransfer.files&&e.dataTransfer.files[0]){const s=e.dataTransfer.files[0];if(s.size>10485760)return void m("File is too large. Maximum size is 10MB.");if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(s.type))return void m("Unsupported file format. Please use PDF, DOC, or DOCX.");l(s)}}),[]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{open:k,onOpenChange:C,children:e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"Confirmer la suppression"}),e.jsx(b,{children:"Êtes-vous sûr de vouloir supprimer votre CV ? Cette action est irréversible."})]}),e.jsxs(j,{className:"flex justify-end space-x-2",children:[e.jsx(r,{variant:"outline",onClick:()=>C(!1),children:"Annuler"}),e.jsx(r,{variant:"destructive",onClick:M,disabled:A,children:A?"Suppression...":"Supprimer"})]})]})}),U&&e.jsx("div",{className:"bg-gray-50 p-3 sm:p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[e.jsx(v,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-500 flex-shrink-0"}),e.jsx("div",{className:"min-w-0",children:e.jsx("h3",{className:"font-medium text-sm sm:text-base truncate",children:"CV"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full sm:w-auto gap-2 sm:gap-3",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:B,disabled:A,className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center",children:[e.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5"}),"Télécharger"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:I,disabled:A,className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center text-red-500 hover:text-red-700",children:[e.jsx(z,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5"}),"Supprimer"]})]})]})}),!U&&e.jsx("div",{className:"border-2 border-dashed rounded-lg p-3 sm:p-6 text-center "+(c?"border-blue-500 bg-blue-50":"border-gray-300"),onDragEnter:_,onDragOver:_,onDragLeave:_,onDrop:J,children:e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-2 sm:space-y-4",children:[e.jsx("div",{className:"mx-auto w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(P,{className:"h-4 w-4 sm:h-6 sm:w-6 text-blue-500"})}),e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-medium",children:"Déposez votre CV ici"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Glissez-déposez votre fichier ici, ou cliquez pour parcourir"})]}),e.jsxs("div",{children:[e.jsx("input",{id:"cv-upload",type:"file",accept:".pdf,.doc,.docx",onChange:F,className:"hidden"}),e.jsx(r,{variant:"outline",onClick:()=>document.getElementById("cv-upload").click(),className:"mx-auto text-xs sm:text-sm h-8 sm:h-9 px-3 sm:px-4",children:"Parcourir les fichiers"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Formats acceptés : PDF, DOC, DOCX (max 10MB)"})]})}),i&&!U&&e.jsx("div",{className:"mt-3 bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 min-w-0 w-full sm:w-auto",children:[e.jsx(N,{className:"h-4 w-4 sm:h-5 sm:w-5 text-blue-500 flex-shrink-0"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("h3",{className:"font-medium text-xs sm:text-sm truncate",children:"CV"})})]}),e.jsx(r,{onClick:R,disabled:T,size:"sm",className:"w-full sm:w-auto text-xs sm:text-sm h-8 sm:h-9 justify-center",children:T?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e.jsx("span",{children:"Envoi en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1.5 dark:text-white"}),e.jsx("p",{className:"dark:text-white",children:"Envoyer"})]})})]})}),d&&e.jsxs("div",{className:"mt-2 p-2 sm:p-3 bg-red-50 text-red-700 rounded-md flex items-start space-x-2",children:[e.jsx($,{className:"h-4 w-4 sm:h-5 sm:w-5 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-xs sm:text-sm flex-1",children:d})]}),D&&!U&&!i&&e.jsx("div",{className:"text-center py-4 sm:py-6",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center space-y-2 sm:space-y-3",children:[e.jsx("div",{className:"rounded-full bg-gray-200 h-8 w-8 sm:h-10 sm:w-10"}),e.jsx("div",{className:"h-2 sm:h-3 bg-gray-200 rounded w-32 sm:w-40"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-24 sm:w-32"})]})})]})}));J.displayName="CVUpload";const q=s.memo((({profile:t,onProfileUpdate:r})=>{const[n,i]=s.useState(!1),[l,c]=s.useState(!1),[o,d]=s.useState(!1);s.useEffect((()=>{if(t)try{t.studentProfile?(c(Boolean(t.studentProfile.isSeekingInternship)),d(Boolean(t.studentProfile.isSeekingApprenticeship))):(c(Boolean(t.isSeekingInternship)),d(Boolean(t.isSeekingApprenticeship)))}catch(e){}}),[t]);const m=s.useCallback((async()=>{if(!n)try{i(!0);const e=!l;c(e);const s=await k.toggleInternshipSeeking(e);if(!s||!s.success)throw c(!e),new Error("Échec de la mise à jour");a.success("Recherche de stage "+(e?"activée":"désactivée"))}catch(e){console.error("Erreur lors de la mise à jour du statut de recherche de stage:",e),a.error("Une erreur est survenue lors de la mise à jour de votre statut de recherche")}finally{i(!1)}}),[n,l]),u=s.useCallback((async()=>{if(!n)try{i(!0);const e=!o;d(e);const s=await k.toggleApprenticeshipSeeking(e);if(!s||!s.success)throw d(!e),new Error("Échec de la mise à jour");a.success("Recherche d'alternance "+(e?"activée":"désactivée"))}catch(e){console.error("Erreur lors de la mise à jour du statut de recherche d'alternance:",e),a.error("Une erreur est survenue lors de la mise à jour de votre statut de recherche")}finally{i(!1)}}),[n,o]);return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("p",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300",children:["Activez ces options pour indiquer que vous êtes à la recherche d'un emploi et/ou d'une alternance.",e.jsx("strong",{className:"block mt-2 sm:mt-3",children:"Vous pouvez activer les deux options simultanément si vous êtes ouvert aux deux types d'opportunités."})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 rounded-lg "+(l?"bg-blue-50 border border-blue-200 dark:bg-blue-900/20 dark:border-blue-700":"bg-gray-50 dark:bg-gray-800/50"),children:[e.jsxs("div",{className:"flex items-start sm:items-center space-x-3 mb-3 sm:mb-0",children:[e.jsx("div",{className:"p-2 rounded-full "+(l?"bg-blue-100 dark:bg-blue-900/30":"bg-gray-100 dark:bg-gray-700"),children:e.jsx(C,{className:"h-4 w-4 sm:h-5 sm:w-5 "+(l?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"seeking-internship",className:"text-sm sm:text-base font-medium text-gray-800 dark:text-gray-200",children:"Recherche de stage"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Activez cette option si vous recherchez un stage"})]})]}),e.jsx(L,{id:"seeking-internship",checked:l,onCheckedChange:m,disabled:n,className:"ml-0 sm:ml-4"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 rounded-lg "+(o?"bg-purple-50 border border-purple-200 dark:bg-purple-900/20 dark:border-purple-700":"bg-gray-50 dark:bg-gray-800/50"),children:[e.jsxs("div",{className:"flex items-start sm:items-center space-x-3 mb-3 sm:mb-0",children:[e.jsx("div",{className:"p-2 rounded-full "+(o?"bg-purple-100 dark:bg-purple-900/30":"bg-gray-100 dark:bg-gray-700"),children:e.jsx(E,{className:"h-4 w-4 sm:h-5 sm:w-5 "+(o?"text-purple-600 dark:text-purple-400":"text-gray-500 dark:text-gray-400")})}),e.jsxs("div",{children:[e.jsx(U,{htmlFor:"seeking-apprenticeship",className:"text-sm sm:text-base font-medium text-gray-800 dark:text-gray-200",children:"Recherche d'alternance"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Activez cette option si vous recherchez une alternance"})]})]}),e.jsx(L,{id:"seeking-apprenticeship",checked:o,onCheckedChange:u,disabled:n,className:"ml-0 sm:ml-4"})]}),(l||o)&&e.jsx("div",{className:"mt-4 p-3 sm:p-4 bg-green-50 border border-green-200 dark:bg-green-900/20 dark:border-green-700 rounded-lg",children:e.jsxs("p",{className:"text-xs sm:text-sm text-green-800 dark:text-green-300",children:[e.jsx("span",{className:"font-semibold",children:"Votre profil est visible"})," par les recruteurs et les entreprises partenaires. Assurez-vous que votre CV est à jour pour maximiser vos chances."]})})]})]})}));q.displayName="JobSeekingSettings";export{J as C,F as E,q as J,M as S,I as a,R as f};
