import{j as e}from"./ui-B5ZVMT00.js";import{r,u as s,L as a}from"./router-Cgxi-4fo.js";import{u as o,a as t,L as i,b as l,p as n,t as d,A as c,m,C as u,c as p,d as b,e as x}from"./index-CmOIAGkt.js";import{P as h}from"./PageTransition-D4vAKVDk.js";import"./react-0RZ2pslC.js";import"./query-DUefEkVx.js";import"./charts-D4j3G6dB.js";const g=r.memo((({id:s,label:a,type:o="text",value:t,onChange:i,error:l,onBlur:n,...d})=>{const[c,m]=r.useState(!1),u="password"===o?c?"text":"password":o;return e.jsxs("div",{children:[e.jsx("label",{htmlFor:s,className:"block text-sm font-medium text-white mb-1",children:a}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("input",{id:s,name:s,type:u,value:t,onChange:i,onBlur:n,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#528eb2] focus:border-[#528eb2] sm:text-sm",...d}),"password"===o&&e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-500",onClick:()=>m(!c),children:c?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),l&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l})]})]})}));g.displayName="FormInput";const f=r.forwardRef(((c,m)=>{const[u,p]=r.useState({email:"",password:"",rememberMe:!1}),[b,x]=r.useState(!1),[h,f]=r.useState({}),v=s();o();const{refreshRoles:y}=t(),j=r.useMemo((()=>({admin:{email:"admin@bigproject.com",password:"Password123@"},superadmin:{email:"superadmin@bigproject.com",password:"Password123@"},teacher:{email:"teacher@bigproject.com",password:"Password123@"},student:{email:"student@bigproject.com",password:"Password123@"},hr:{email:"hr@bigproject.com",password:"Password123@"},guest:{email:"guest@bigproject.com",password:"Password123@"},recruiter:{email:"recruiter@bigproject.com",password:"Password123@"}})),[]),w=r.useCallback((e=>{j[e]&&p((r=>({...r,email:j[e].email,password:j[e].password})))}),[j]);r.useImperativeHandle(m,(()=>({quickLogin:w})));const N=r.useCallback((e=>{const{name:r,value:s,type:a,checked:o}=e.target;p((e=>({...e,[r]:"checkbox"===a?o:s})))}),[]);return r.useEffect((()=>{const e=localStorage.getItem("rememberedEmail");e&&p((r=>({...r,email:e,rememberMe:!0})))}),[]),e.jsxs("div",{className:"w-full rounded-lg mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-blue-300 mb-2",children:"Connexion"}),e.jsxs("p",{className:"text-sm text-blue-200",children:["Accédez à votre espace ",e.jsxs("span",{className:"font-bold text-white",children:["Big",e.jsx("span",{className:"text-[#528eb2]",children:"Project"})]})]})]}),h.auth&&e.jsx("div",{className:"p-3 mb-5 text-red-400 bg-red-900/30 border border-red-700 rounded",children:h.auth}),e.jsxs("form",{className:"space-y-6",onSubmit:async e=>{e.preventDefault(),f({});const r={};if(u.email?/\S+@\S+\.\S+/.test(u.email)||(r.email="Format d'email invalide"):r.email="L'email est requis",u.password||(r.password="Le mot de passe est requis"),Object.keys(r).length>0)f(r);else{x(!0);try{await l.login(u.email,u.password);u.rememberMe?localStorage.setItem("rememberedEmail",u.email):localStorage.removeItem("rememberedEmail");try{const e=await n.getAllProfileData({forceRefresh:!0}),r=!!(e&&e.stats&&e.stats.profile&&e.stats.profile.isAcknowledged);localStorage.setItem("profileIsAcknowledged",r?"true":"false")}catch(s){console.warn("Erreur lors de la récupération du profil après login:",s),localStorage.removeItem("profileIsAcknowledged")}window.dispatchEvent(new Event("login-success"));const e=sessionStorage.getItem("returnTo");setTimeout((()=>{if(e)sessionStorage.removeItem("returnTo"),v(e);else{const e=localStorage.getItem("token");let s="/dashboard";if(e)try{const r=e.split(".");if(3===r.length){const e=JSON.parse(atob(r[1]));if(e.roles&&e.roles.length>0){switch(e.roles[0]){case"ROLE_ADMIN":s="/admin/dashboard";break;case"ROLE_SUPERADMIN":s="/superadmin/dashboard";break;case"ROLE_TEACHER":s="/teacher/dashboard";break;case"ROLE_STUDENT":s="/student/dashboard";break;case"ROLE_HR":s="/hr/dashboard";break;case"ROLE_GUEST":s="/guest/dashboard";break;case"ROLE_RECRUITER":s="/recruiter/dashboard";break;default:return l.logout(),void v("/login")}}}}catch(r){console.error("Error parsing token:",r)}v(s)}d.success("Connexion réussie")}),150);const r=()=>{y(),window.removeEventListener("user-data-loaded",r)};window.addEventListener("user-data-loaded",r);setTimeout((async()=>{try{const e=l.getUser();e&&0!==Object.keys(e).length||(console.warn("User data missing after login, attempting to fix..."),await l.fixProfileDataIssues())}catch(s){console.error("Error handling profile data after login:",s)}}),2e3)}catch(a){if(a.response){const{data:e}=a.response;"EMAIL_NOT_VERIFIED"===e.code?(f({email:"Email non vérifié"}),d.error("Email non vérifié",{description:"Veuillez vérifier votre email avant de vous connecter.",action:{label:"Renvoyer l'email",onClick:()=>v("/verification-error")},duration:5e3})):e.message?(f({auth:e.message}),d.error("Erreur de connexion",{description:e.message})):(f({auth:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}),d.error("Erreur de connexion",{description:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}))}else f({auth:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}),d.error("Erreur de connexion",{description:"Une erreur est survenue lors de la connexion. Veuillez réessayer."})}finally{x(!1)}}},children:[e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"email",name:"email",label:"Adresse email",type:"email",autoComplete:"email",required:!0,value:u.email,onChange:N,error:h.email}),e.jsx("div",{className:"absolute -right-2 -top-2 w-10 h-10 rounded-full filter blur-xl opacity-20"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password",name:"password",label:"Mot de passe",type:"password",autoComplete:"current-password",required:!0,value:u.password,onChange:N,error:h.password}),e.jsx("div",{className:"absolute -left-2 -bottom-2 w-10 h-10 bg-purple-500 rounded-full filter blur-xl opacity-20"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",checked:u.rememberMe,onChange:N,className:"h-4 w-4 text-blue-500 focus:ring-blue-500 border-gray-700 rounded bg-gray-800"}),e.jsx("label",{htmlFor:"rememberMe",className:"block ml-2 text-sm text-gray-300",children:"Se souvenir de moi"})]}),e.jsx("div",{className:"text-sm",children:e.jsx(a,{to:"/reset-password",className:"font-medium text-blue-400 hover:text-blue-300",children:"Mot de passe oublié?"})})]}),e.jsx("div",{children:e.jsxs("button",{type:"submit",disabled:b,className:"relative w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-105 disabled:opacity-70 disabled:cursor-not-allowed overflow-hidden group",children:[e.jsx("span",{className:"relative z-10 flex items-center justify-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"mr-2 h-4 w-4 animate-spin inline-block"}),e.jsx("span",{children:"Connexion en cours..."})]}):"Se connecter"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-600 opacity-0 group-hover:opacity-100 transition-opacity"})]})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-400",children:"Vous n'avez pas encore de compte?"})})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(a,{to:"/register",className:"relative w-full flex justify-center py-3 px-4 border border-gray-700 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-800/50 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-105 overflow-hidden group",children:[e.jsx("span",{className:"relative z-10",children:"S'inscrire"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-800 via-blue-900/30 to-gray-800 opacity-0 group-hover:opacity-100 transition-opacity"})]})})]})]})}));f.displayName="AuthFormComponent";const v=f,y=({onQuickLogin:s})=>{const[a,o]=r.useState(!0),t=e=>{const r={blue:"bg-blue-600/80 hover:bg-blue-600 border-blue-500/30",red:"bg-red-600/80 hover:bg-red-600 border-red-500/30",pink:"bg-pink-600/80 hover:bg-pink-600 border-pink-500/30",green:"bg-green-600/80 hover:bg-green-600 border-green-500/30",yellow:"bg-yellow-600/80 hover:bg-yellow-600 border-yellow-500/30",purple:"bg-purple-600/80 hover:bg-purple-600 border-purple-500/30",gray:"bg-gray-600/80 hover:bg-gray-600 border-gray-500/30"};return r[e]||r.blue};return e.jsxs("div",{className:"fixed bottom-20 right-4 z-50 flex flex-col items-end",children:[e.jsx(c,{children:a&&e.jsxs(m.div,{className:"bg-gray-900/90 backdrop-blur-md p-4 rounded-lg border border-blue-500/30 shadow-2xl mb-2 overflow-hidden",initial:{x:300,opacity:0},animate:{x:0,opacity:1},exit:{x:300,opacity:0},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsx("p",{className:"text-sm text-blue-300 text-center font-medium mb-3",children:"Dev Quick Login"}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center max-w-[280px]",children:[{id:"admin",label:"Admin",color:"blue"},{id:"superadmin",label:"Superadmin",color:"red"},{id:"recruiter",label:"Recruiter",color:"pink"},{id:"teacher",label:"Teacher",color:"green"},{id:"student",label:"Student",color:"yellow"},{id:"hr",label:"HR",color:"purple"},{id:"guest",label:"Guest",color:"gray"}].map((r=>e.jsx(m.button,{type:"button",onClick:()=>s(r.id),className:`px-3 py-2 text-sm font-medium text-white ${t(r.color)} rounded-md backdrop-blur-sm border`,whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},children:r.label},r.id)))})]})}),e.jsxs(m.button,{className:"bg-gray-900/90 backdrop-blur-md text-blue-300 p-3 rounded-full border border-blue-500/30 shadow-lg flex items-center justify-center",onClick:()=>{o(!a)},whileHover:{scale:1.1},whileTap:{scale:.95},initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:[a?e.jsx(u,{className:"h-5 w-5"}):e.jsx(p,{className:"h-5 w-5"}),e.jsx("span",{className:"ml-2 font-medium text-sm",children:a?"Fermer":"Login"})]})]})},j=()=>{const{colorMode:a,currentTheme:t}=b(),i=r.useRef(),n=s(),c=o();return e.jsx(h,{children:e.jsxs("div",{className:`min-h-screen ${t.bg} flex flex-col overflow-hidden relative`,children:[e.jsx(x,{colorMode:a,animationMode:"cosmic",shootingStarDirection:"horizontal"}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-4 py-12",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(m.div,{className:"relative z-10",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.7,delay:.3},children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:1,delay:.5}}),e.jsx("div",{className:"relative bg-gray-900/80 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border border-blue-500/30",children:e.jsx(v,{ref:i,onSubmit:async e=>{try{await new Promise((e=>setTimeout(e,100)));const e=c.getRoleDashboardPath();n(e,{replace:!0}),d.success("Connexion réussie"),setTimeout((async()=>{try{const e=l.getUser();e&&0!==Object.keys(e).length||(console.warn("User data missing after login, attempting to fix..."),await l.fixProfileDataIssues())}catch(e){console.error("Error handling profile data after login:",e)}}),2e3)}catch(r){console.error("Error during login:",r)}},onError:e=>{"verification-error"===e&&n("/verification-error")}})})]})})}),e.jsx(y,{onQuickLogin:e=>{i.current&&i.current.quickLogin(e)}})]})})};export{j as default};
