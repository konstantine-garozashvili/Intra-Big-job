import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,u as r,L as t}from"./router-D7BdrHDj.js";import{u as a,a as o,b as n,t as i,m as l}from"./index-Bd05LC-l.js";import{L as d}from"./loader-circle-BrSWE4DC.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";const c=({onQuickLogin:s})=>e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2 text-center",children:"Connexion rapide (Dev only)"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 max-w-[500px] mx-auto",children:[e.jsx("button",{type:"button",onClick:()=>s("admin"),className:"px-3 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Admin"}),e.jsx("button",{type:"button",onClick:()=>s("superadmin"),className:"px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700",children:"Superadmin"}),e.jsx("button",{type:"button",onClick:()=>s("recruiter"),className:"px-3 py-2 text-sm font-medium text-white bg-pink-600 rounded-md hover:bg-pink-700",children:"Recruiter"}),e.jsx("button",{type:"button",onClick:()=>s("teacher"),className:"px-3 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700",children:"Teacher"}),e.jsx("button",{type:"button",onClick:()=>s("student"),className:"px-3 py-2 text-sm font-medium text-white bg-yellow-600 rounded-md hover:bg-yellow-700",children:"Student"}),e.jsx("button",{type:"button",onClick:()=>s("hr"),className:"px-3 py-2 text-sm font-medium text-white bg-purple-600 rounded-md hover:bg-purple-700",children:"HR"}),e.jsx("button",{type:"button",onClick:()=>s("guest"),className:"col-start-2 px-3 py-2 text-sm font-medium text-white bg-gray-600 rounded-md hover:bg-gray-700",children:"Guest"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-500 bg-white",children:"Ou connectez-vous manuellement"})})]})]}),m=s.memo((({id:r,label:t,type:a="text",value:o,onChange:n,error:i,onBlur:l,...d})=>{const[c,m]=s.useState(!1),u="password"===a?c?"text":"password":a;return e.jsxs("div",{children:[e.jsx("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-1",children:t}),e.jsxs("div",{className:"mt-1 relative",children:[e.jsx("input",{id:r,name:r,type:u,value:o,onChange:n,onBlur:l,className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-[#528eb2] focus:border-[#528eb2] sm:text-sm",...d}),"password"===a&&e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-500",onClick:()=>m(!c),children:c?e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),i&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i})]})]})}));function u(){const[l,u]=s.useState({email:"",password:"",rememberMe:!1}),[x,p]=s.useState(!1),[h,b]=s.useState({}),g=r();a();const{refreshRoles:j}=o(),f=s.useMemo((()=>({admin:{email:"admin@bigproject.com",password:"Password123@"},superadmin:{email:"superadmin@bigproject.com",password:"Password123@"},teacher:{email:"teacher@bigproject.com",password:"Password123@"},student:{email:"student@bigproject.com",password:"Password123@"},hr:{email:"hr@bigproject.com",password:"Password123@"},guest:{email:"guest@bigproject.com",password:"Password123@"},recruiter:{email:"recruiter@bigproject.com",password:"Password123@"}})),[]),y=s.useCallback((e=>{f[e]&&u((s=>({...s,email:f[e].email,password:f[e].password})))}),[f]),v=s.useCallback((e=>{const{name:s,value:r,type:t,checked:a}=e.target;u((e=>({...e,[s]:"checkbox"===t?a:r})))}),[]);return s.useEffect((()=>{const e=localStorage.getItem("rememberedEmail");e&&u((s=>({...s,email:e,rememberMe:!0})))}),[]),e.jsxs("div",{className:"w-full bg-white p-8 rounded-lg shadow-lg mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 mb-2",children:"Connexion"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Accédez à votre espace ",e.jsxs("span",{className:"font-bold text-[#02284f]",children:["Big",e.jsx("span",{className:"text-[#528eb2]",children:"Project"})]})]})]}),e.jsx(c,{onQuickLogin:y}),h.auth&&e.jsx("div",{className:"p-3 mb-5 text-red-700 bg-red-100 border border-red-400 rounded",children:h.auth}),e.jsxs("form",{className:"space-y-6",onSubmit:async e=>{e.preventDefault(),b({});const s={};if(l.email?/\S+@\S+\.\S+/.test(l.email)||(s.email="Format d'email invalide"):s.email="L'email est requis",l.password||(s.password="Le mot de passe est requis"),Object.keys(s).length>0)b(s);else{p(!0);try{await n.login(l.email,l.password);l.rememberMe?localStorage.setItem("rememberedEmail",l.email):localStorage.removeItem("rememberedEmail"),window.dispatchEvent(new Event("login-success"));const e=sessionStorage.getItem("returnTo");setTimeout((()=>{if(e)sessionStorage.removeItem("returnTo"),g(e);else{const e=localStorage.getItem("token");let r="/dashboard";if(e)try{const s=e.split(".");if(3===s.length){const e=JSON.parse(atob(s[1]));if(e.roles&&e.roles.length>0){switch(e.roles[0]){case"ROLE_ADMIN":r="/admin/dashboard";break;case"ROLE_SUPERADMIN":r="/superadmin/dashboard";break;case"ROLE_TEACHER":r="/teacher/dashboard";break;case"ROLE_STUDENT":r="/student/dashboard";break;case"ROLE_HR":r="/hr/dashboard";break;default:r="/dashboard"}}}}catch(s){console.error("Error parsing token:",s)}g(r)}i.success("Connexion réussie")}),150);const s=()=>{j(),window.removeEventListener("user-data-loaded",s)};window.addEventListener("user-data-loaded",s)}catch(r){if(r.response){const{data:e}=r.response;"EMAIL_NOT_VERIFIED"===e.code?(b({email:"Email non vérifié"}),i.error("Email non vérifié",{description:"Veuillez vérifier votre email avant de vous connecter.",action:{label:"Renvoyer l'email",onClick:()=>g("/verification-error")},duration:5e3})):e.message?(b({auth:e.message}),i.error("Erreur de connexion",{description:e.message})):(b({auth:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}),i.error("Erreur de connexion",{description:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}))}else b({auth:"Une erreur est survenue lors de la connexion. Veuillez réessayer."}),i.error("Erreur de connexion",{description:"Une erreur est survenue lors de la connexion. Veuillez réessayer."})}finally{p(!1)}}},children:[e.jsx(m,{id:"email",name:"email",label:"Adresse email",type:"email",autoComplete:"email",required:!0,value:l.email,onChange:v,error:h.email}),e.jsx(m,{id:"password",name:"password",label:"Mot de passe",type:"password",autoComplete:"current-password",required:!0,value:l.password,onChange:v,error:h.password}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",checked:l.rememberMe,onChange:v,className:"h-4 w-4 text-[#528eb2] focus:ring-[#528eb2] border-gray-300 rounded"}),e.jsx("label",{htmlFor:"rememberMe",className:"block ml-2 text-sm text-gray-700",children:"Se souvenir de moi"})]}),e.jsx("div",{className:"text-sm",children:e.jsx(t,{to:"/reset-password",className:"font-medium text-[#528eb2] hover:text-[#02284f]",children:"Mot de passe oublié?"})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:x,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#528eb2] hover:bg-[#528eb2]/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#528eb2] transition-all transform hover:scale-105 disabled:opacity-70 disabled:cursor-not-allowed",children:x?e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mr-2 h-4 w-4 animate-spin"}),"Connexion en cours..."]}):"Se connecter"})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 text-gray-500 bg-white",children:"Vous n'avez pas encore de compte?"})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(t,{to:"/register",className:"w-full flex justify-center py-3 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#528eb2]",children:"S'inscrire"})})]})]})}m.displayName="FormInput";const x=s.memo((({children:s})=>e.jsx(l.div,{initial:"initial",animate:"in",exit:"out",variants:{initial:{opacity:0,y:5},in:{opacity:1,y:0},out:{opacity:0,y:-5}},transition:{type:"tween",ease:[.25,.1,.25,1],duration:.3},style:{willChange:"opacity, transform",transform:"translateZ(0)"},children:s})));x.displayName="PageTransition";const p=()=>e.jsx(x,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-md px-4",children:e.jsx(u,{})})})});export{p as default};
