import{j as e}from"./ui-B5ZVMT00.js";import{r as s,e as a,u as t}from"./router-Cgxi-4fo.js";import{o as r,q as i,r as n,s as l,v as o,w as c,B as d,x as m,t as u}from"./index-B55PlCdI.js";import{I as x}from"./input-1ijeD5KU.js";import{P as p}from"./RegisterUtils-BcwBG7D4.js";import{E as j,a as h}from"./eye-D_y5-0g7.js";import"./react-0RZ2pslC.js";import"./query-DUefEkVx.js";import"./charts-D4j3G6dB.js";const f=()=>{const[f,v]=s.useState(""),[y,w]=s.useState(""),[g,N]=s.useState(!1),[b,C]=s.useState(!0),[S,k]=s.useState(!1),[L,V]=s.useState(!1),[q,z]=s.useState(!1),{token:I}=a(),D=t();s.useEffect((()=>{I&&(async()=>{C(!0);try{const e=await m.get(`/api/reset-password/verify/${I}`);e.success?(N(!0),u.success("Vous pouvez maintenant définir votre nouveau mot de passe")):(N(!1),u.error(e.message||"Lien de réinitialisation invalide"))}catch(e){N(!1),u.error("Ce lien de réinitialisation est invalide ou a expiré.")}finally{C(!1)}})()}),[I]);return b?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{children:"Vérification du token..."})})}):g?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsxs(r,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(n,{children:"Définir un nouveau mot de passe"}),e.jsx(l,{children:"Veuillez entrer et confirmer votre nouveau mot de passe."})]}),e.jsx(o,{children:e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),f.length<8)u.error("Le mot de passe doit contenir au moins 8 caractères");else if(f===y){k(!0);try{const e=await m.post(`/api/reset-password/reset/${I}`,{password:f});e.success?(u.success("Votre mot de passe a été réinitialisé avec succès"),setTimeout((()=>{D("/login")}),2e3)):u.error(e.message||"Une erreur est survenue")}catch(s){const e=s.response?.data?.message||"Impossible de réinitialiser votre mot de passe. Veuillez réessayer plus tard.";u.error(e)}finally{k(!1)}}else u.error("Les mots de passe ne correspondent pas")},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"password",type:L?"text":"password",value:f,onChange:e=>v(e.target.value),autoComplete:"new-password",required:!0,className:"w-full pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>V((e=>!e)),tabIndex:"-1",children:L?e.jsx(j,{className:"h-4 w-4 text-gray-400"}):e.jsx(h,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx(p,{password:f}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le mot de passe doit contenir au moins 8 caractères."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"confirmPassword",type:q?"text":"password",value:y,onChange:e=>w(e.target.value),autoComplete:"new-password",required:!0,className:"w-full pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>z((e=>!e)),tabIndex:"-1",children:q?e.jsx(j,{className:"h-4 w-4 text-gray-400"}):e.jsx(h,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsx(d,{type:"submit",className:"w-full",disabled:S,children:S?"Mise à jour...":"Réinitialiser mon mot de passe"})]})})})]})}):e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsxs(r,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(n,{children:"Lien invalide ou expiré"}),e.jsx(l,{children:"Le lien de réinitialisation que vous avez utilisé est invalide ou a expiré."})]}),e.jsx(o,{children:e.jsx("p",{className:"text-center",children:"Veuillez demander un nouveau lien de réinitialisation."})}),e.jsx(c,{className:"flex justify-center",children:e.jsx(d,{onClick:()=>D("/reset-password"),children:"Demander un nouveau lien"})})]})})};export{f as default};
