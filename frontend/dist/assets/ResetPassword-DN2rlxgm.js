import{j as e}from"./ui-B9MhWaVJ.js";import{r as s,e as r,u as t}from"./router-D7BdrHDj.js";import{k as a,l as i,n,o,p as l,q as c,B as d,r as m,t as u}from"./index-Bd05LC-l.js";import{I as x}from"./input-CRxVDqWf.js";import{P as p}from"./RegisterUtils-CNzMSx0C.js";import{E as j,a as h}from"./eye-BQU9fKOB.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";const f=()=>{const[f,v]=s.useState(""),[y,g]=s.useState(""),[w,N]=s.useState(!1),[b,k]=s.useState(!0),[C,S]=s.useState(!1),[V,L]=s.useState(!1),[q,z]=s.useState(!1),{token:E}=r(),I=t();s.useEffect((()=>{E&&(async()=>{k(!0);try{console.log("Vérification du token:",E);const e=await m.get(`/api/reset-password/verify/${E}`);console.log("Réponse de vérification:",e),e.success?(N(!0),u.success("Vous pouvez maintenant définir votre nouveau mot de passe")):(N(!1),u.error(e.message||"Lien de réinitialisation invalide"))}catch(e){console.error("Erreur de vérification:",e),N(!1),u.error("Ce lien de réinitialisation est invalide ou a expiré.")}finally{k(!1)}})()}),[E]);return b?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{children:"Vérification du token..."})})}):w?e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsxs(a,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(n,{children:"Définir un nouveau mot de passe"}),e.jsx(o,{children:"Veuillez entrer et confirmer votre nouveau mot de passe."})]}),e.jsx(l,{children:e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),f.length<8)u.error("Le mot de passe doit contenir au moins 8 caractères");else if(f===y){S(!0);try{console.log("Envoi de la réinitialisation pour le token:",E);const e=await m.post(`/api/reset-password/reset/${E}`,{password:f});console.log("Réponse de réinitialisation:",e),e.success?(u.success("Votre mot de passe a été réinitialisé avec succès"),setTimeout((()=>{I("/login")}),2e3)):u.error(e.message||"Une erreur est survenue")}catch(s){console.error("Erreur de réinitialisation:",s);const e=s.response?.data?.message||"Impossible de réinitialiser votre mot de passe. Veuillez réessayer plus tard.";u.error(e)}finally{S(!1)}}else u.error("Les mots de passe ne correspondent pas")},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"password",type:V?"text":"password",value:f,onChange:e=>v(e.target.value),autoComplete:"new-password",required:!0,className:"w-full pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>L((e=>!e)),tabIndex:"-1",children:V?e.jsx(j,{className:"h-4 w-4 text-gray-400"}):e.jsx(h,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx(p,{password:f}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Le mot de passe doit contenir au moins 8 caractères."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"confirmPassword",type:q?"text":"password",value:y,onChange:e=>g(e.target.value),autoComplete:"new-password",required:!0,className:"w-full pr-10"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>z((e=>!e)),tabIndex:"-1",children:q?e.jsx(j,{className:"h-4 w-4 text-gray-400"}):e.jsx(h,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsx(d,{type:"submit",className:"w-full",disabled:C,children:C?"Mise à jour...":"Réinitialiser mon mot de passe"})]})})})]})}):e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-50",children:e.jsxs(a,{className:"w-full max-w-md",children:[e.jsxs(i,{children:[e.jsx(n,{children:"Lien invalide ou expiré"}),e.jsx(o,{children:"Le lien de réinitialisation que vous avez utilisé est invalide ou a expiré."})]}),e.jsx(l,{children:e.jsx("p",{className:"text-center",children:"Veuillez demander un nouveau lien de réinitialisation."})}),e.jsx(c,{className:"flex justify-center",children:e.jsx(d,{onClick:()=>I("/reset-password"),children:"Demander un nouveau lien"})})]})})};export{f as default};
