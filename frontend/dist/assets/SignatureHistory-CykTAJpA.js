import{j as e}from"./ui-B5ZVMT00.js";import{r as s}from"./router-Cgxi-4fo.js";import{y as a,m as t,L as r,B as n,o as i,q as l,r as d,s as c,v as o,j as u,aA as h,aB as g,aC as m,av as x,aD as j,au as p,b as y,t as b}from"./index-B55PlCdI.js";import{T as f,a as w,b as N,c as D,d as k,e as v}from"./table-BOfc4hnL.js";import{A as S,a as T,b as H}from"./alert-C5A0QBqW.js";import{C as A}from"./circle-alert-ePuFY6ZA.js";import{R as C}from"./refresh-cw-DdYQs95L.js";import{C as E}from"./circle-check-big-D3cjoSfZ.js";import{C as M}from"./circle-x-w6gzBF0O.js";
/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=a("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),I={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05,delayChildren:.1}}},_={hidden:{y:10,opacity:0},visible:{y:0,opacity:1,transition:{type:"spring",stiffness:300,damping:25}}},q=()=>{const[a,q]=s.useState(!0),[$,L]=s.useState(null),[P,z]=s.useState(null),[F,R]=s.useState(!1),J=async()=>{try{F?R(!0):q(!0),z(null),await y.ensureUserDataInLocalStorage();const s=localStorage.getItem("token");if(!s)throw new Error("Token d'authentification non trouvé");let a=!1,t=null;try{const e=await fetch("/api/signatures/weekly",{method:"GET",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"}});if(!e.ok){const s=await e.json().catch((()=>({})));throw console.error("API error response:",s),new Error(s.message||`Erreur ${e.status}`)}t=await e.json(),a=!0,t&&t.signaturesByDate&&(t.signaturesByDate=t.signaturesByDate.filter((e=>!["Saturday","Sunday"].includes(e.dayName))))}catch(e){console.error("API request failed:",e)}if(a&&t)L(t);else{const e=new Date,s=e.getDay(),a=0===s?-6:1-s,t=new Date(e);t.setDate(e.getDate()+a);const r=[];for(let l=0;l<5;l++){const e=new Date(t);e.setDate(t.getDate()+l),r.push(e)}const n=r.map((e=>e.toISOString().split("T")[0])),i={success:!0,weekStart:n[0],weekEnd:new Date(r[4]).setDate(r[4].getDate()+1),availablePeriods:{morning:"Matin (9h-12h)",afternoon:"Après-midi (13h-17h)"},signaturesByDate:[]};n.forEach(((e,s)=>{const a=`signature_${e}_morning`,t=`signature_${e}_afternoon`,n=`signature_data_${e}_morning`,l=`signature_data_${e}_afternoon`,d="true"===localStorage.getItem(a),c="true"===localStorage.getItem(t);let o=null,u=null;if(d){const s=localStorage.getItem(n);if(s)try{o=JSON.parse(s)}catch(g){}o||(o={date:`${e}T09:30:00.000Z`})}if(c){const s=localStorage.getItem(l);if(s)try{u=JSON.parse(s)}catch(g){}u||(u={date:`${e}T14:30:00.000Z`})}const h=r[s];i.signaturesByDate.push({date:e,dayName:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][h.getDay()],signatures:{morning:d?o:null,afternoon:c?u:null}})})),L(i)}}catch(s){console.error("Error fetching weekly history:",s),z(s.message||"Erreur de chargement de l'historique"),b.error("Erreur",{description:s.message||"Impossible de charger l'historique des signatures"})}finally{q(!1),R(!1)}};s.useEffect((()=>{J()}),[]);return a&&!F?e.jsxs(t.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(r,{className:"h-10 w-10 animate-spin text-primary"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Chargement de l'historique des signatures..."})]}):P?e.jsx(t.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(S,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(T,{children:"Erreur"}),e.jsxs(H,{children:[P,e.jsxs(n,{className:"mt-4",variant:"outline",onClick:J,size:"sm",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]})]})}):$?((()=>{if(!$?.signaturesByDate)return{total:0,present:0};let e=0,s=0;const a=new Date;a.setHours(0,0,0,0);const t=(new Date).getHours();$.signaturesByDate.forEach((r=>{const n=new Date(r.date);n.setHours(0,0,0,0);const i=n>a,l=!(n.getTime()===a.getTime()&&t<12),d=!(n.getTime()===a.getTime()&&t<17);i||(l&&(e+=1,r.signatures&&r.signatures.morning&&(s+=1)),d&&(e+=1,r.signatures&&r.signatures.afternoon&&(s+=1)))})),e>0&&Math.round(s/e*100)})(),e.jsx(t.div,{className:"space-y-6",variants:I,initial:"hidden",animate:"visible",children:e.jsx(t.div,{variants:_,children:e.jsxs(i,{children:[e.jsxs(l,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-primary"}),"Détail des signatures"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{R(!0),J()},disabled:F,className:"gap-1",children:[F?e.jsx(r,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(C,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Actualiser"})]})]}),e.jsx(c,{children:"Historique détaillé des signatures pour la semaine en cours"})]}),e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(f,{children:[e.jsx(w,{children:e.jsxs(N,{children:[e.jsx(D,{className:"w-[100px]",children:"Jour"}),e.jsx(D,{children:"Date"}),e.jsx(D,{className:"text-center",children:"Matin (9h-12h)"}),e.jsx(D,{className:"text-center",children:"Après-midi (13h-17h)"})]})}),e.jsx(k,{children:$.signaturesByDate.map((s=>{return e.jsxs(N,{children:[e.jsx(v,{className:"font-medium",children:(a=s.dayName,{Monday:"Lundi",Tuesday:"Mardi",Wednesday:"Mercredi",Thursday:"Jeudi",Friday:"Vendredi"}[a]||a)}),e.jsx(v,{children:new Date(s.date).toLocaleDateString("fr-FR")}),e.jsx(v,{className:"text-center",children:e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(m,{className:"cursor-help inline-flex",children:s.signatures.morning?e.jsxs(x,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800 gap-1",children:[e.jsx(E,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Présent"})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(s.date);t.setHours(0,0,0,0);return t>a||t.getTime()===a.getTime()&&(new Date).getHours()<12?e.jsxs(x,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800 gap-1",children:[e.jsx(u,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"À venir"})]}):e.jsxs(x,{variant:"outline",className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800 gap-1",children:[e.jsx(M,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Absent"})]})})()}),e.jsx(j,{side:"bottom",children:s.signatures.morning?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{children:["Signé à ",new Date(s.signatures.morning.date).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(s.date);t.setHours(0,0,0,0);return t>a||t.getTime()===a.getTime()&&(new Date).getHours()<12?e.jsx("p",{children:"Période à venir"}):e.jsx("p",{children:"Aucune signature enregistrée"})})()})]})})}),e.jsx(v,{className:"text-center",children:e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(m,{className:"cursor-help inline-flex",children:s.signatures.afternoon?e.jsxs(x,{variant:"outline",className:"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800 gap-1",children:[e.jsx(E,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Présent"})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(s.date);t.setHours(0,0,0,0);return t>a||t.getTime()===a.getTime()&&(new Date).getHours()<17?e.jsxs(x,{variant:"outline",className:"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800 gap-1",children:[e.jsx(u,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"À venir"})]}):e.jsxs(x,{variant:"outline",className:"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border-red-200 dark:border-red-800 gap-1",children:[e.jsx(M,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Absent"})]})})()}),e.jsx(j,{side:"bottom",children:s.signatures.afternoon?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-green-600"}),e.jsxs("p",{children:["Signé à ",new Date(s.signatures.afternoon.date).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]})]}):(()=>{const a=new Date;a.setHours(0,0,0,0);const t=new Date(s.date);t.setHours(0,0,0,0);return t>a||t.getTime()===a.getTime()&&(new Date).getHours()<17?e.jsx("p",{children:"Période à venir"}):e.jsx("p",{children:"Aucune signature enregistrée"})})()})]})})})]},s.date);var a}))})]})})})]})})})):e.jsx(t.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(i,{children:[e.jsxs(l,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-muted-foreground"}),"Aucune donnée"]}),e.jsx(c,{children:"Aucun historique de signatures n'est disponible"})]}),e.jsx(o,{children:e.jsxs(n,{variant:"outline",onClick:J,size:"sm",className:"w-full",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Actualiser les données"]})})]})})};export{q as S};
