import{j as e}from"./ui-DiOaG2iA.js";import{r as s}from"./router-D7BdrHDj.js";import{I as r,aq as a,t,aB as i}from"./index-BpIDiI3H.js";import{A as l,a as n,b as c}from"./alert-CRBCn-DA.js";import{C as d}from"./circle-alert-e-A8qJUH.js";import{f as o}from"./index-BzsTtQfi.js";import{C as m}from"./circle-check-big-xPab4atj.js";import"./react-0RZ2pslC.js";import"./query-D8UIi9X6.js";import"./charts-DkICKEBk.js";const u=()=>{const[i,u]=s.useState([]),[x,h]=s.useState(!0),[j,p]=s.useState(null);s.useEffect((()=>{const e=async()=>{try{h(!0);const e=await fetch("/api/signatures",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Failed to fetch signatures");const s=await e.json();u(s.signatures),p(null)}catch(e){p("Impossible de récupérer les signatures. Veuillez réessayer plus tard."),t.error("Erreur",{description:"Impossible de récupérer les signatures. Veuillez réessayer plus tard."})}finally{h(!1)}};e();const s=setInterval(e,6e4);return()=>clearInterval(s)}),[]);return x?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):j?e.jsxs(l,{variant:"destructive",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(n,{children:"Erreur"}),e.jsx(c,{children:j})]}):0===i.length?e.jsxs(l,{variant:"info",children:[e.jsx(d,{className:"h-4 w-4"}),e.jsx(n,{children:"Information"}),e.jsx(c,{children:"Aucune signature n'est disponible pour le moment."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Suivi des signatures"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map((s=>e.jsxs("div",{className:"border rounded-lg p-4 shadow-sm bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium",children:[s.user.firstName," ",s.user.lastName]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o(new Date(s.date),"PPP à HH:mm",{locale:r})})]}),e.jsx(a,{variant:s.validated?"success":"pending",children:s.validated?"Validé":"En attente"})]}),e.jsx("div",{className:"text-sm mb-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Localisation:"})," ",s.location]})}),!s.validated&&e.jsx("button",{onClick:()=>(async e=>{try{if(!(await fetch(`/api/signatures/${e}/validate`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to validate signature");u(i.map((s=>s.id===e?{...s,validated:!0}:s))),t.success("Validation réussie",{description:"La signature a été validée avec succès."})}catch(s){t.error("Erreur de validation",{description:"Impossible de valider la signature. Veuillez réessayer."})}})(s.id),className:"w-full bg-primary text-white py-2 px-4 rounded-md hover:bg-primary/90 transition-colors",children:"Valider la présence"}),s.validated&&e.jsxs("div",{className:"flex items-center text-green-500",children:[e.jsx(m,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:"Présence confirmée"})]})]},s.id)))})]})},x=()=>e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Suivi des présences"}),e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(u,{})}),e.jsx(i,{})]});export{x as default};
