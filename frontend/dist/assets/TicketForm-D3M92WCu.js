import{j as e}from"./ui-B9MhWaVJ.js";import{r,u as t}from"./router-D7BdrHDj.js";import{t as s,ab as o}from"./index-Dh3VsLo2.js";import"./react-0RZ2pslC.js";import"./query-DKQ6_O-p.js";import"./charts-DkICKEBk.js";function a(){const[a,i]=r.useState(""),[n,l]=r.useState(""),[d,c]=r.useState(""),[u,m]=r.useState([]),[b,g]=r.useState(!1),[p,h]=r.useState(!0),[f,x]=r.useState("Veuillez fournir les détails de votre problème"),[y,v]=r.useState(!1),k=t();r.useEffect((()=>{(()=>{try{const e=localStorage.getItem("token");if(!e)return;const r=e.split(".");if(3!==r.length)return;const t=JSON.parse(atob(r[1])),s=t.roles&&(t.roles.includes("ROLE_ADMIN")||t.roles.includes("ROLE_SUPERADMIN"));v(s)}catch(e){console.error("Error checking admin role:",e)}})()}),[]),r.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return s.error("Authentication required"),void k("/login");const r=await o.get("/api/ticket-services",{headers:{Authorization:`Bearer ${e}`}});m(r.data),h(!1)}catch(e){console.error("Error fetching services:",e),s.error("Failed to load services"),h(!1)}})()}),[k]);return p?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md dark:bg-gray-800",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-900 dark:text-white",children:"Créer un ticket de support"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()&&n.trim()&&d){g(!0);try{const e=localStorage.getItem("token");if(!e)return s.error("Authentication required"),void k("/login");const r=await o.post("/api/tickets",{title:a.trim(),description:n.trim(),serviceId:parseInt(d)},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});s.success("Ticket créé avec succès"),r.data.isAdmin?k("/admin/tickets"):k("/tickets")}catch(r){console.error("Error creating ticket:",r),s.error(r.response?.data?.message||"Échec de la création du ticket")}finally{g(!1)}}else s.error("Veuillez remplir tous les champs obligatoires")},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Titre *"}),e.jsx("input",{id:"title",type:"text",value:a,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:"Description brève de votre problème",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"service",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Service concerné *"}),e.jsxs("select",{id:"service",value:d,onChange:e=>{const r=e.target.value;if(c(r),r){const e=u.find((e=>e.id==r));e&&e.description?x(`${e.description} - Veuillez fournir plus de détails`):x("Veuillez fournir les détails de votre problème")}else x("Veuillez fournir les détails de votre problème")},className:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner un service"}),u.map((r=>e.jsx("option",{value:r.id,children:r.name},r.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Description *"}),e.jsx("textarea",{id:"description",value:n,onChange:e=>l(e.target.value),rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",placeholder:f,required:!0})]}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{type:"button",onClick:()=>k(-1),className:"mr-4 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:b?"Envoi en cours...":"Envoyer"})]})]})]})}export{a as default};
