import{j as e}from"./ui-CEgDFHEN.js";import{r as t,L as r}from"./router-Cgxi-4fo.js";import{aW as a,t as s}from"./index-CbCqSr3O.js";import"./react-0RZ2pslC.js";import"./query-CdiCT4_A.js";import"./charts-D4j3G6dB.js";const d={Ouvert:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300","En cours":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300","Résolu":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300","Fermé":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300","En attente":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},i={Low:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",Normal:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",High:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"};function l(){const[l,c]=t.useState([]),[o,n]=t.useState(!0),[x,g]=t.useState(null),[u,m]=t.useState(""),[h,p]=t.useState(""),[y,b]=t.useState(""),[k,f]=t.useState(!1),[j,w]=t.useState([]),[v,N]=t.useState([]);t.useEffect((()=>{(()=>{try{const e=localStorage.getItem("token");if(!e)return;const t=e.split(".");if(3!==t.length)return;const r=JSON.parse(atob(t[1])),a=r.roles&&(r.roles.includes("ROLE_ADMIN")||r.roles.includes("ROLE_SUPERADMIN"));f(a),a&&(window.location.href="/admin/tickets")}catch(e){console.error("Error checking admin role:",e)}})()}),[]),t.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return;const t=await a.get("/api/tickets/status",{headers:{Authorization:`Bearer ${e}`}});t.data&&t.data.statuses&&w(t.data.statuses)}catch(e){console.error("Error fetching statuses:",e)}})()}),[]),t.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return;const t=await a.get("/api/ticket-services",{headers:{Authorization:`Bearer ${e}`}});N(t.data)}catch(e){console.error("Error fetching services:",e)}})()}),[]),t.useEffect((()=>{(async()=>{try{const e=localStorage.getItem("token");if(!e)return g("Authentication required"),void n(!1);const t=await a.get("/api/tickets",{headers:{Authorization:`Bearer ${e}`}});c(t.data.tickets),n(!1)}catch(e){console.error("Error fetching tickets:",e),g("Failed to load tickets. Please try again later."),s.error("Failed to load tickets"),n(!1)}})()}),[]);const S=l.filter((e=>(!u||e.status.name===u)&&((!h||e.priority===h)&&!(y&&(!e.service||e.service.id!==parseInt(y)))))),E=()=>{m(""),p(""),b("")};return o?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):x?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:e.jsx("p",{children:x})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4 md:mb-0",children:"Vos tickets"}),e.jsx(r,{to:"/tickets/new",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Créer un nouveau ticket"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Filtrer les tickets"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Statut"}),e.jsxs("select",{value:u,onChange:e=>m(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),j.map((t=>e.jsx("option",{value:t.name,children:t.name},t.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Priorité"}),e.jsxs("select",{value:h,onChange:e=>p(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Toutes les priorités"}),e.jsx("option",{value:"Low",children:"Basse"}),e.jsx("option",{value:"Normal",children:"Normale"}),e.jsx("option",{value:"High",children:"Haute"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Service"}),e.jsxs("select",{value:y,onChange:e=>b(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"",children:"Tous les services"}),v.map((t=>e.jsx("option",{value:t.id,children:t.name},t.id)))]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:E,className:"px-4 py-2 text-sm text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 dark:bg-gray-700 dark:text-white dark:hover:bg-gray-600",children:"Effacer les filtres"})})]}),0===S.length?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucun ticket ne correspond à vos critères"}),(u||h||y)&&e.jsx("button",{onClick:E,className:"mt-4 px-4 py-2 text-sm text-blue-700 bg-blue-100 rounded-md hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800",children:"Effacer les filtres"})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Titre"}),k&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Créé par"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Service"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Statut"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Priorité"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Date de création"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300",children:"Dernière mise à jour"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700",children:S.map((t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer",onClick:()=>window.location.href=`/tickets/${t.id}`,children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["#",t.id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:e.jsx(r,{to:`/tickets/${t.id}`,children:t.title})}),k&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.creator?`${t.creator.firstName} ${t.creator.lastName}`:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.service?t.service.name:"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${d[t.status.name]}`,children:t.status.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${i[t.priority||"Normal"]}`,children:t.priority||"Normal"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"N/A"})]},t.id)))})]})})})]})}export{l as default};
