import{j as e}from"./ui-B5ZVMT00.js";import{r as a,u as r}from"./router-Cgxi-4fo.js";import{A as s,a as t,b as o}from"./alert-Cf7jkOrV.js";import{q as l,S as i,w as n,x as d,aS as c,ay as m,j as x,M as h,B as u,aQ as f,aP as v,C as g,D as p,k as j,I as b,l as w,n as k,J as y,aT as N,t as C,N as S}from"./index-CoAfTMaM.js";import{I as z}from"./input-CYXRhd_2.js";import{S as D,a as L,b as q,c as M,d as E}from"./select-TM9Oua8T.js";import{F as B}from"./filter-PILtDRIy.js";import{L as A,a as I}from"./list-CBEE_czH.js";import{C as $}from"./circle-alert-DuxHPlDS.js";import"./react-0RZ2pslC.js";import"./query-DUefEkVx.js";import"./charts-D4j3G6dB.js";import"./index-jVOyRz7F.js";const F={"Développement Web":"bg-gradient-to-r from-amber-100 via-yellow-100 to-orange-100 dark:from-amber-900 dark:via-yellow-900 dark:to-orange-900 text-amber-800 dark:text-amber-200 hover:from-amber-200 hover:via-yellow-200 hover:to-orange-200 dark:hover:from-amber-800 dark:hover:via-yellow-800 dark:hover:to-orange-800","Data Science":"bg-gradient-to-r from-blue-100 via-cyan-100 to-teal-100 dark:from-blue-900 dark:via-cyan-900 dark:to-teal-900 text-blue-700 dark:text-blue-300 hover:from-blue-200 hover:via-cyan-200 hover:to-teal-200 dark:hover:from-blue-800 dark:hover:via-cyan-800 dark:hover:to-teal-800","Cybersécurité":"bg-gradient-to-r from-violet-100 via-purple-100 to-fuchsia-100 dark:from-violet-900 dark:via-purple-900 dark:to-fuchsia-900 text-violet-700 dark:text-violet-300 hover:from-violet-200 hover:via-purple-200 hover:to-fuchsia-200 dark:hover:from-violet-800 dark:hover:via-purple-800 dark:hover:to-fuchsia-800",DevOps:"bg-gradient-to-r from-orange-100 via-amber-100 to-yellow-100 dark:from-orange-900 dark:via-amber-900 dark:to-yellow-900 text-orange-700 dark:text-orange-300 hover:from-orange-200 hover:via-amber-200 hover:to-yellow-200 dark:hover:from-orange-800 dark:hover:via-amber-800 dark:hover:to-yellow-800",IA:"bg-gradient-to-r from-indigo-100 via-blue-100 to-sky-100 dark:from-indigo-900 dark:via-blue-900 dark:to-sky-900 text-indigo-700 dark:text-indigo-300 hover:from-indigo-200 hover:via-blue-200 hover:to-sky-200 dark:hover:from-indigo-800 dark:hover:via-blue-800 dark:hover:to-sky-800","Cloud Computing":"bg-gradient-to-r from-sky-100 via-cyan-100 to-blue-100 dark:from-sky-900 dark:via-cyan-900 dark:to-blue-900 text-sky-700 dark:text-sky-300 hover:from-sky-200 hover:via-cyan-200 hover:to-blue-200 dark:hover:from-sky-800 dark:hover:via-cyan-800 dark:hover:to-blue-800",default:"bg-gradient-to-r from-emerald-100 via-teal-100 to-cyan-100 dark:from-emerald-900 dark:via-teal-900 dark:to-cyan-900 text-emerald-700 dark:text-emerald-300 hover:from-emerald-200 hover:via-teal-200 hover:to-cyan-200 dark:hover:from-emerald-800 dark:hover:via-teal-800 dark:hover:to-cyan-800"},V="requestedFormations";const P=s=>{const{formation:t,viewMode:o,profileData:S,loading:z=!1}=s;if(z||!t)return e.jsxs(l,{className:"h-full flex flex-col bg-white dark:bg-slate-800 shadow-lg border-0 overflow-hidden rounded-lg transition-all duration-300 group cursor-pointer",children:[e.jsxs("div",{className:"relative aspect-[16/9] overflow-hidden",children:[e.jsx(i,{className:"w-full h-full object-cover object-center"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:e.jsx(i,{className:"h-8 w-32 rounded-full"})})]}),e.jsxs(n,{className:"flex-grow p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(i,{className:"h-5 w-24 rounded-full"}),e.jsx(i,{className:"h-5 w-16 rounded-full"})]}),e.jsx(i,{className:"h-7 w-2/3 mb-2 rounded"}),e.jsx(i,{className:"h-4 w-full mb-2 rounded"}),e.jsx(i,{className:"h-4 w-1/2 mb-2 rounded"}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs sm:text-sm w-full gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4 rounded-full"}),e.jsx(i,{className:"h-4 w-24 rounded"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-4 rounded-full"}),e.jsx(i,{className:"h-4 w-16 rounded"})]})]})]}),e.jsx(d,{className:"p-4 pt-0",children:e.jsx(i,{className:"h-10 w-full rounded-lg"})})]});const{id:D,name:L,promotion:q,image_url:M,specialization:E,description:B,dateStart:A,location:I}=t,[$,P]=a.useState(!1),[R,J]=a.useState(!1),[O,T]=a.useState(!1),W=r?r():null;a.useEffect((()=>{let e=!0;return(async()=>{try{const r=c.getMyEnrollmentRequests?await c.getMyEnrollmentRequests():await async function(){const e=await fetch("/api/formation-requests/my",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Erreur lors du chargement des demandes");return await e.json()}();let s=[];r&&r.requests?s=r.requests.filter((e=>null===e.status)).map((e=>e.formation.id)):Array.isArray(r)&&(s=r.filter((e=>null===e.status)).map((e=>e.formation?.id||e.formation_id)));const o=function(){try{return JSON.parse(localStorage.getItem(V))||[]}catch{return[]}}().filter((e=>s.includes(e)));a=o,localStorage.setItem(V,JSON.stringify(a)),e&&P(s.includes(Number(t.id)))}catch(r){}var a})(),()=>{e=!1}}),[t.id]);return e.jsxs(l,{className:"h-full flex flex-col bg-white dark:bg-slate-800 shadow-lg border-0 overflow-hidden rounded-lg transition-all duration-300 group cursor-pointer",onClick:()=>W&&W(`/formations/${D}`),children:[e.jsxs("div",{className:"relative aspect-[16/9] overflow-hidden",children:[e.jsx("img",{src:M||"/placeholder.svg",alt:L,className:"w-full h-full object-cover object-center transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-t from-[#02284f]/90 via-[#02284f]/50 to-transparent z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:e.jsx("span",{className:"text-white text-lg font-semibold drop-shadow-lg",children:"Voir détail"})})]}),e.jsxs(n,{className:"flex-grow p-4 sm:p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(m,{className:`${F[E?.name||"default"]} transition-all duration-300 text-xs sm:text-sm`,children:E?.name||"Formation"}),e.jsx(m,{variant:"outline",className:"bg-gradient-to-r from-amber-50 to-white dark:from-amber-900/20 dark:to-slate-900 border-amber-200 dark:border-amber-700/50 text-xs sm:text-sm",children:q})]}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold mb-2 text-slate-800 dark:text-slate-100 line-clamp-2",children:L}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-2 text-sm line-clamp-3 min-h-[3em]",children:B||"Aucune description disponible"}),e.jsxs("div",{className:"flex justify-between items-center mt-2 text-xs sm:text-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-300",children:[e.jsx(x,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Début le ",A?A instanceof Date?A.toLocaleDateString():new Date(A).toLocaleDateString():""]})]}),I&&e.jsxs("div",{className:"flex items-center gap-2 text-[#528eb2] dark:text-[#78b9dd]",children:[e.jsx(h,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:I})]})]})]}),e.jsx(d,{className:"p-4 pt-0",children:$?e.jsxs(u,{className:"w-full text-sm sm:text-base font-medium bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-300 cursor-not-allowed flex items-center justify-center gap-2",disabled:!0,onClick:e=>e.stopPropagation(),children:[e.jsx(f,{className:"h-4 w-4 sm:h-5 sm:w-5 mr-2"}),"Demande envoyée"]}):e.jsxs(v,{className:"w-full text-sm sm:text-base font-medium bg-gradient-to-r from-amber-400 via-[#528eb2] to-[#78b9dd] hover:from-transparent hover:to-transparent hover:text-amber-600 dark:hover:text-white",onClick:e=>{e.stopPropagation(),T(!0)},disabled:R,children:["Demander à rejoindre",e.jsx(g,{className:"ml-2 h-4 w-4 sm:h-5 sm:w-5"})]})}),e.jsx(p,{open:O,onOpenChange:T,children:e.jsxs(j,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Confirmer la demande"}),e.jsx(k,{children:"Voulez-vous vraiment rejoindre cette formation ? Cette action enverra une demande d'inscription."})]}),e.jsxs(y,{children:[e.jsx(u,{variant:"outline",onClick:()=>T(!1),children:"Annuler"}),e.jsx(u,{onClick:async a=>{a.stopPropagation(),await(async()=>{if(t){J(!0),P(!0);try{await c.requestEnrollment(t.id),await N.requested({formationName:t.name,formationId:t.id,userId:S?.id}),T(!1),C.success(e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"font-bold",children:"Demande envoyée !"})]}),{duration:5e3})}catch(a){if(a?.message&&a.message.toLowerCase().includes("demande d'inscription créée avec succès"))return await N.requested({formationName:t.name,formationId:t.id,userId:S?.id}),T(!1),C.success(e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"font-bold",children:"Demande envoyée !"})]}),{duration:5e3}),void J(!1);C.error(a.message||"Erreur lors de la demande d'inscription à la formation."),P(!1)}finally{J(!1)}}})()},disabled:R,children:"Confirmer"})]})]})})]})},R=({filters:r,onFilterChange:s,specializations:t})=>(a.useEffect((()=>{}),[r.specialization,t]),e.jsxs("div",{className:"w-full p-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm space-y-4 md:space-y-0 md:flex md:gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 w-4 h-4"}),e.jsx(z,{placeholder:"Rechercher une formation...",value:r.search,onChange:e=>s("search",e.target.value),className:"pl-10"})]}),e.jsxs(D,{value:r.specialization||"all",onValueChange:e=>s("specialization",e),children:[e.jsx(L,{className:"w-48",children:e.jsx(q,{placeholder:"Spécialisation"})}),e.jsxs(M,{children:[e.jsx(E,{value:"all",children:"Toutes les spécialisations"}),t.map((a=>e.jsx(E,{value:a.id.toString(),className:"cursor-pointer hover:bg-amber-50 dark:hover:bg-amber-900/20",children:a.name},a.id)))]})]}),e.jsxs(D,{value:r.sortBy,onValueChange:e=>s("sortBy",e),children:[e.jsx(L,{className:"w-40",children:e.jsx(q,{placeholder:"Trier par"})}),e.jsxs(M,{children:[e.jsx(E,{value:"dateStart",children:"Date de début"}),e.jsx(E,{value:"name",children:"Nom"}),e.jsx(E,{value:"capacity",children:"Capacité"})]})]}),e.jsxs(u,{variant:"outline",onClick:()=>s("reset"),className:"flex items-center gap-2 hover:bg-amber-50 dark:hover:bg-amber-900/20",children:[e.jsx(B,{className:"w-4 h-4"}),"Réinitialiser"]})]})),J=({viewMode:a,onViewModeChange:r})=>e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"\n          rounded-lg p-1 flex\n          bg-secondary\n          border border-muted\n          shadow-sm\n          transition-colors\n          dark:bg-slate-800 bg-white\n        ",children:[e.jsxs(u,{variant:"grid"===a?"default":"ghost",size:"sm",onClick:()=>r("grid"),className:`\n            flex items-center gap-2\n            rounded-md\n            transition-colors\n            ${"grid"===a?"bg-gradient-to-r from-amber-100 to-amber-50 dark:from-amber-900/30 dark:to-amber-800/20 text-amber-700 dark:text-amber-300":"text-muted-foreground hover:bg-amber-50 dark:hover:bg-amber-900/20"}\n          `,children:[e.jsx(A,{className:`\n              w-4 h-4\n              ${"grid"===a?"text-amber-600 dark:text-amber-300":"text-muted-foreground"}\n              transition-colors\n            `}),e.jsx("span",{children:"Grille"})]}),e.jsxs(u,{variant:"list"===a?"default":"ghost",size:"sm",onClick:()=>r("list"),className:`\n            flex items-center gap-2\n            rounded-md\n            transition-colors\n            ${"list"===a?"bg-gradient-to-r from-amber-100 to-amber-50 dark:from-amber-900/30 dark:to-amber-800/20 text-amber-700 dark:text-amber-300":"text-muted-foreground hover:bg-amber-50 dark:hover:bg-amber-900/20"}\n          `,children:[e.jsx(I,{className:`\n              w-4 h-4\n              ${"list"===a?"text-amber-600 dark:text-amber-300":"text-muted-foreground"}\n              transition-colors\n            `}),e.jsx("span",{children:"Liste"})]})]})}),O=()=>e.jsxs("div",{className:"w-full p-4 bg-white dark:bg-slate-800 rounded-lg shadow-sm space-y-4 md:space-y-0 md:flex md:gap-4 items-center",children:[e.jsx(i,{className:"h-10 w-full md:w-64 rounded"}),e.jsx(i,{className:"h-10 w-48 rounded"}),e.jsx(i,{className:"h-10 w-40 rounded"}),e.jsx(i,{className:"h-10 w-36 rounded"})]}),T=()=>e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"rounded-lg p-1 flex bg-secondary border border-muted shadow-sm transition-colors dark:bg-slate-800 bg-white gap-2",children:[e.jsx(i,{className:"h-8 w-20 rounded-md"}),e.jsx(i,{className:"h-8 w-20 rounded-md"})]})}),W=()=>{r();const[l,n]=a.useState([]),[d,m]=a.useState([]),[x,h]=a.useState(!0),[u,f]=a.useState(null),[v,g]=a.useState("grid"),[p,j]=a.useState({search:"",specialization:"all",sortBy:"dateStart"}),b=a.useMemo((()=>{const e=new Set(l.map((e=>e.specialization?.id)).filter(Boolean));return d.filter((a=>e.has(a.id)))}),[l,d]);a.useEffect((()=>{(async()=>{try{h(!0);const[e,a]=await Promise.all([c.getAllFormations(),c.getSpecializations()]),r=e.formations||[];n(r),m(a)}catch(e){f(e.message)}finally{h(!1)}})()}),[]);const w=async e=>{try{await c.requestEnrollment(e),C.success("Votre demande pour rejoindre la formation a été envoyée avec succès.")}catch(a){C.error(a.message||"Erreur lors de la demande d'inscription à la formation.")}},k=l.filter((e=>{const a=e.name.toLowerCase().includes(p.search.toLowerCase())||e.description?.toLowerCase().includes(p.search.toLowerCase()),r="all"===p.specialization||e.specialization&&e.specialization.id.toString()===p.specialization;return a&&r})).sort(((e,a)=>{switch(p.sortBy){case"name":return e.name.localeCompare(a.name);case"capacity":return a.capacity-e.capacity;default:return new Date(e.dateStart)-new Date(a.dateStart)}}));return u?e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs(s,{variant:"destructive",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(t,{children:"Erreur"}),e.jsx(o,{children:u})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:x?e.jsxs("div",{className:"flex flex-col space-y-8",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(i,{className:"h-8 w-64 mb-2"}),e.jsx(i,{className:"h-5 w-80"})]}),e.jsx(O,{}),e.jsx(T,{}),e.jsx("div",{className:"grid gap-6 grid-cols-1 sm:grid-cols-1 md:grid-cols-2 mb-8",children:[...Array(4)].map(((a,r)=>e.jsx(P,{loading:!0,viewMode:v,formation:void 0},r)))})]}):e.jsxs("div",{className:"flex flex-col space-y-8",children:[e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Formations disponibles"}),e.jsx("p",{className:"text-muted-foreground",children:"Découvrez nos formations et rejoignez celle qui vous correspond"})]}),e.jsx(R,{filters:p,onFilterChange:(e,a)=>{j("reset"!==e?r=>({...r,[e]:a}):{search:"",specialization:"all",sortBy:"dateStart"})},specializations:b}),e.jsx("div",{className:"flex justify-end",children:e.jsx(J,{viewMode:v,onViewModeChange:g})}),e.jsx("div",{className:`\n            grid gap-6\n            ${"grid"===v?"grid-cols-1 sm:grid-cols-1 md:grid-cols-2":"grid-cols-1"}\n            ${"list"===v?"max-w-[1200px] mx-auto":""}\n          `,children:k.map((a=>e.jsx(P,{formation:a,onRequestJoin:w,viewMode:v},a.id)))}),0===k.length&&e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-xl text-muted-foreground",children:"Aucune formation ne correspond à vos critères"})})]})})};export{W as default};
