import{a as e,a1 as r,ab as t,ax as a}from"./index-DebaQ5DR.js";import"./router-D7BdrHDj.js";import{b as o}from"./query-DKQ6_O-p.js";const n={formation:{name:"Développement Web et Mobile",level:"Bac+3",year:"2023-2024",duration:"12 mois",students:25},courses:[{id:1,name:"Frontend Development",module:"Module 1",schedule:"Lundi 9h-12h"},{id:2,name:"Backend Development",module:"Module 2",schedule:"Mardi 14h-17h"},{id:3,name:"Mobile Development",module:"Module 3",schedule:"Jeudi 9h-12h"}],attendance:[{id:1,module:"Frontend Development",date:"2024-03-18",present:22,absent:3},{id:2,module:"Backend Development",date:"2024-03-19",present:23,absent:2},{id:3,module:"Mobile Development",date:"2024-03-21",present:21,absent:4}],grades:[{id:1,module:"Frontend Development",student:"Alice Martin",grade:85},{id:2,module:"Backend Development",student:"Bob Wilson",grade:92},{id:3,module:"Mobile Development",student:"Claire Brown",grade:78}],alerts:[{id:1,type:"exam",message:"Examen Frontend Development - 25 Mars",priority:"high"},{id:2,type:"meeting",message:"Réunion pédagogique formation Dev Web - 22 Mars 14h",priority:"medium"},{id:3,type:"alert",message:"Rendu des projets Module 2 - 30 Mars",priority:"high"}]};const s=new class{constructor(){this.data=n}async isAuthorized(){try{if(!e.isLoggedIn())return!1;return(await e.getCurrentUser()).roles.includes("ROLE_TEACHER")}catch(r){return console.error("Erreur lors de la vérification des autorisations:",r),!1}}async getFormationInfo(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data.formation}async getCourses(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data.courses}async getAttendance(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data.attendance}async getGrades(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data.grades}async getAlerts(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data.alerts}async getDashboardData(){if(!(await this.isAuthorized()))throw new Error("Non autorisé");return this.data}},i=()=>{const r=t();return o({queryKey:["dashboard-user",r],queryFn:async()=>{const r=localStorage.getItem("user");if(r)try{const e=JSON.parse(r),t=e._extractedAt||0;if(Date.now()-t<3e5)return e}catch(a){}const t=sessionStorage.getItem("last_user_data_fetch");if(t){if(Date.now()-parseInt(t,10)<2e3&&r)try{return JSON.parse(r)}catch(a){}}sessionStorage.setItem("last_user_data_fetch",Date.now().toString());try{return await e.getCurrentUser()}catch(o){try{const r=e.getMinimalUserData();if(r)return r}catch(n){throw o}}},staleTime:3e5,cacheTime:36e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchInterval:!1,retry:2,retryDelay:e=>Math.min(1e3*2**e,1e4),onSuccess:e=>{},onError:e=>{}})},c=()=>{const e=i(),o=t(),n=r("/teacher/dashboard",["teacher-dashboard",o],{staleTime:9e5,cacheTime:18e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!1,initialData:()=>{try{const e=a().getQueryData(["teacher-dashboard",o]);return e||void 0}catch(e){return}},enabled:!!e.data,queryFn:async()=>{try{return await s.getDashboardData()}catch(e){throw e}}});return{user:e.data,dashboardData:n.data,isLoading:e.isLoading||n.isLoading,isError:e.isError||n.isError,error:e.error||n.error,refetch:()=>{e.refetch(),n.refetch()}}},d=()=>{const e=t(),o=(()=>{try{const e=localStorage.getItem("user");if(e)return JSON.parse(e)}catch(e){console.error("Error parsing user data from localStorage:",e)}return null})(),n=!!localStorage.getItem("token"),s=r("/users",["admin-users",e],{staleTime:6e5,cacheTime:18e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!1,initialData:()=>{try{const r=a().getQueryData(["admin-users",e]);return r||void 0}catch(r){return}},enabled:n,retry:1,retryDelay:1e3,timeout:4e3}),i=r("/api/me",["user-data",e],{staleTime:18e5,cacheTime:36e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!1,retry:1,retryDelay:1e3,timeout:4e3,enabled:n,select:e=>e.user||e});return{user:i.data||o,users:s.data?.data||[],isLoading:i.isLoading&&!o||s.isLoading,isError:i.isError||s.isError,error:i.error||s.error,refetch:()=>{i.refetch(),s.refetch()}}},u=()=>{const e=i();return{user:e.data,isLoading:e.isLoading,isError:e.isError,error:e.error,refetch:()=>{e.refetch()}}},h=()=>{const o=t(),n=(()=>{try{return e.getMinimalUserData()}catch(r){console.error("Error retrieving minimal user data:",r)}return null})(),s=localStorage.getItem("token"),i=r("/api/me",["user-data-hr",o],{staleTime:18e5,cacheTime:36e5,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!1,retry:1,retryDelay:1e3,timeout:4e3,enabled:!!s,select:e=>e.user||e,initialData:()=>{if(n)return n;try{const e=a().getQueryData(["user-data-hr",o]);return e||void 0}catch(e){return}}});return{user:i.data||n,isLoading:i.isLoading&&!n,isError:i.isError,error:i.error,refetch:()=>{i.refetch()}}};export{u as a,c as b,h as c,i as d,d as u};
